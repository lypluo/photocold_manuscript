# do_manual_class<-FALSE
# PFT_name<-"All PFTs"
#----------------
#do classification:
#----------------
df.event<-df$df_dday
df.noevent<-df$df_noevent_dday
#merge df.event and df.noevent
##2022,Aug-->change the "GPP overestimated sites" to "SY_OSB", the other to "SY_ASB"
# df.event$year_flag<-rep("GPP overestimated sites",nrow(df.event))
# df.noevent$year_flag<-rep("GPP non-overestimated sites",nrow(df.noevent))
df.event$year_flag<-rep("SY_OSB",nrow(df.event))
df.noevent$year_flag<-rep("SY_ASB",nrow(df.noevent))
#
df.all<-rbind(df.event,df.noevent)
df.all$year_flag<-factor(df.all$year_flag,levels = c("SY_OSB","SY_ASB"))
#only select the data dday between -60 to 70:
df.all<-df.all[df.all$dday>=class_dday_range[1] & df.all$dday<=class_dday_range[2],]
#only targeting on one specific PFT
if(PFT_name!="All PFTs"){
df.all<-df.all %>% filter(classid==PFT_name)
}
# Bins for different variables
t_var<-df.all[,class_var]
xmin<-round(min(t_var,na.rm = T),-1)
xmax<-round(max(t_var,na.rm = T),-2)
# bins  <- seq( from=xmin,
#               to=xmax, by=(xmax-xmin)/N )
if(class_var=="SW_IN_midday_mean_fluxnet2015"){
bins<-c(xmin,125,250,375,500,625,750,875,1000)
}
if(class_var=="PPFD_IN_fullday_mean_fluxnet2015"){
bins<-c(0,200,400,600,800,1000,1200,1400,1600)
}
#this is range setting for Tmin not for Rg
if(do_manual_class==TRUE){
xmin<-c(-40)
xmax<-30
bins  <- seq( from=xmin,
to=xmax, by=(xmax-xmin)/N )
}
#
df.all<-df.all %>% mutate(inbin=cut( as.numeric(df.all[,class_var]), breaks = bins ))
#
return(df.all)
}
#-----------------
#start plotting
#----------------
comp_boxplot<-function(df,comp_yvar,do_legend,end_xylab,PFT_name){
# df<-df_bins_SW_IN_all
# comp_yvar<-c("temp_min_fluxnet2015")
# do_legend<-FALSE
# end_xylab<-c("SW_IN midday mean (W m-2)","")
# PFT_name<-"All PFTs"
#------------------------------------
#plotting
#------------------------------------
##
df.tidy<-df[,c("sitename","date",comp_yvar,"inbin","year_flag")]
names(df.tidy)<-c("sitename","date","comp_vary","inbin","year_flag")
#remove the rows when inbin ==NA
df.tidy<-df.tidy[!is.na(df.tidy$inbin),]
##
p_plot_main<-ggplot(df.tidy,aes(x = inbin, y = comp_vary,fill=year_flag))+
geom_boxplot()+
# annotate("rect",xmin=0,xmax=70,ymin = -Inf,ymax = Inf,alpha=0.2)+  #
scale_fill_manual("",values = c("SY_OSB"=adjustcolor("tomato",1),
"SY_ASB"=adjustcolor("dodgerblue",1)))+
geom_hline(yintercept = 0,linetype="dotted",size=1.1)+
theme_classic()+
theme(legend.position = c(0.25,0.99),legend.background = element_blank(),
legend.text = element_text(size=24),
axis.title = element_text(size = 30),
axis.text = element_text(size = 24),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank())+
rotate_x_text(30)+
ylim(-45,28)+
xlab(end_xylab[1])+
ylab(end_xylab[2])
if(comp_yvar=="alpha_SW"|comp_yvar=="alpha_PPFD"){
p_plot_main<-p_plot_main+
ylim(0,1)
}
#legend
if(do_legend==FALSE){
p_plot_main<-p_plot_main+
theme(legend.position = "none")
}
#add the PFT name:
p_plot_main<-p_plot_main+
ggtitle(PFT_name)+
theme(title = element_text(size = 28))
# N_x<-length(unique(df.tidy$inbin))
# p_plot_main<-p_plot_main+
#   annotate(geom = "text",x=N_x/1.7,y=28,label=PFT_name,col="blue",size=10)
#
return(p_plot_main)
}
#A1a).classification:
df_bins_SW_IN_all<-Classify_Nbins_andPlot(df_len5_nonnorm,c(-60,70),"SW_IN_midday_mean_fluxnet2015",8,FALSE,"All PFTs")
#change "ppfd_fluxnet2015" to "PPFD_IN_fullday_mean_fluxnet2015"/PPFD_IN_midday_mean_fluxnet2015
df_bins_ppfd_all<-Classify_Nbins_andPlot(df_len5_nonnorm,c(-60,80),"PPFD_IN_fullday_mean_fluxnet2015",8,FALSE,"All PFTs")
#A1b).plotting--->update in March,2022
#----------------
##For SW
#SW_midday_mean and tmin
p_SW_midday_mean_tmin_all<-comp_boxplot(df_bins_SW_IN_all,c("temp_min_fluxnet2015"),TRUE,
c("SW_IN midday mean (W m-2)","Minimum Ta (°C)"),"All PFTs")
#SW_midday_mean and max
p_SW_midday_mean_tmax_all<-comp_boxplot(df_bins_SW_IN_all,c("temp_max_fluxnet2015"),FALSE,
c("SW_IN middday mean (W m-2)","Maximum Ta (°C)"),"All PFTs")
#SW_midday_mean and tmean
p_SW_midday_mean_tmean_all<-comp_boxplot(df_bins_SW_IN_all,c("temp_day_fluxnet2015"),FALSE,
c("SW_IN middday mean (W m-2)","mean Ta (°C)"),"All PFTs")
#tmin and alpha_SW
p_SW_midday_mean_alpha_SW_all<-comp_boxplot(df_bins_SW_IN_all,c("alpha_SW"),FALSE,c("SW_IN middday mean (W m-2)","alpha_SW"),"All PFTs")
# tmin and alpha_PPFD
# p_SW_midday_mean_alpha_PPFD<-comp_boxplot(df_bins_SW_IN,c("alpha_PPFD"),FALSE,c("SW_IN middday mean (W m-2)","alpha_PPFD"))
#-------------
##For ppfd
p_ppfd_midday_mean_tmin_all<-comp_boxplot(df_bins_ppfd_all,c("temp_min_fluxnet2015"),TRUE,
c("PAR midday mean (umol m-2 s-1)","Minimum Ta (°C)"),"All PFTs")
p_ppfd_midday_alpha_PPFD_all<-comp_boxplot(df_bins_ppfd_all,c("alpha_PPFD"),FALSE,
c("PAR middday mean (W m-2)","alpha_PPFD"),"All PFTs")
#------------------------------
#A1c).change the labels
p_SW_midday_mean_tmin_all<-p_SW_midday_mean_tmin_all+
xlab("")+
ylab(expression("T"[min]*" (°C)"))
p_ppfd_midday_mean_tmin_all<-p_ppfd_midday_mean_tmin_all+
xlab("")+
ylab(expression("T"[min]*" (°C)"))
########
#A2.For different PFTs:DBF, MF, and ENF
########
df_bins_SW_IN_DBF<-Classify_Nbins_andPlot(df_len5_nonnorm,c(-60,70),"SW_IN_midday_mean_fluxnet2015",8,FALSE,"DBF")
df_bins_SW_IN_MF<-Classify_Nbins_andPlot(df_len5_nonnorm,c(-60,70),"SW_IN_midday_mean_fluxnet2015",8,FALSE,"MF")
df_bins_SW_IN_ENF<-Classify_Nbins_andPlot(df_len5_nonnorm,c(-60,70),"SW_IN_midday_mean_fluxnet2015",8,FALSE,"ENF")
#
df_bins_ppfd_DBF<-Classify_Nbins_andPlot(df_len5_nonnorm,c(-60,80),"PPFD_IN_fullday_mean_fluxnet2015",8,FALSE,"DBF")
df_bins_ppfd_MF<-Classify_Nbins_andPlot(df_len5_nonnorm,c(-60,80),"PPFD_IN_fullday_mean_fluxnet2015",8,FALSE,"MF")
df_bins_ppfd_ENF<-Classify_Nbins_andPlot(df_len5_nonnorm,c(-60,80),"PPFD_IN_fullday_mean_fluxnet2015",8,FALSE,"ENF")
##For SW
p_SW_midday_mean_tmin_DBF<-comp_boxplot(df_bins_SW_IN_DBF,c("temp_min_fluxnet2015"),FALSE,
c("SW_IN midday mean (W m-2)","Minimum Ta (°C)"),"DBF")
p_SW_midday_mean_tmin_MF<-comp_boxplot(df_bins_SW_IN_MF,c("temp_min_fluxnet2015"),FALSE,
c("SW_IN midday mean (W m-2)","Minimum Ta (°C)"),"MF")
p_SW_midday_mean_tmin_ENF<-comp_boxplot(df_bins_SW_IN_ENF,c("temp_min_fluxnet2015"),FALSE,
c("SW_IN midday mean (W m-2)","Minimum Ta (°C)"),"ENF")
##For ppfd
p_ppfd_midday_mean_tmin_DBF<-comp_boxplot(df_bins_ppfd_DBF,c("temp_min_fluxnet2015"),FALSE,
c("PAR midday mean (umol m-2 s-1)","Minimum Ta (°C)"),"DBF")
p_ppfd_midday_mean_tmin_MF<-comp_boxplot(df_bins_ppfd_MF,c("temp_min_fluxnet2015"),FALSE,
c("PAR midday mean (umol m-2 s-1)","Minimum Ta (°C)"),"MF")
p_ppfd_midday_mean_tmin_ENF<-comp_boxplot(df_bins_ppfd_ENF,c("temp_min_fluxnet2015"),FALSE,
c("PAR midday mean (umol m-2 s-1)","Minimum Ta (°C)"),"ENF")
#for albedo:
p_SW_midday_mean_alpha_SW_DBF<-comp_boxplot(df_bins_SW_IN_all,c("alpha_SW"),FALSE,c("SW_IN middday mean (W m-2)","alpha_SW"),"DBF")
p_ppfd_midday_alpha_PPFD_DBF<-comp_boxplot(df_bins_ppfd_all,c("alpha_PPFD"),FALSE,
c("PAR middday mean (W m-2)","alpha_PPFD"),"DBF")
p_SW_midday_mean_alpha_SW_MF<-comp_boxplot(df_bins_SW_IN_all,c("alpha_SW"),FALSE,c("SW_IN middday mean (W m-2)","alpha_SW"),"MF")
p_ppfd_midday_alpha_PPFD_MF<-comp_boxplot(df_bins_ppfd_all,c("alpha_PPFD"),FALSE,
c("PAR middday mean (W m-2)","alpha_PPFD"),"MF")
p_SW_midday_mean_alpha_SW_ENF<-comp_boxplot(df_bins_SW_IN_all,c("alpha_SW"),FALSE,c("SW_IN middday mean (W m-2)","alpha_SW"),"ENF")
p_ppfd_midday_alpha_PPFD_ENF<-comp_boxplot(df_bins_ppfd_all,c("alpha_PPFD"),FALSE,
c("PAR middday mean (W m-2)","alpha_PPFD"),"ENF")
#change the labels
#
p_SW_midday_mean_tmin_DBF<-p_SW_midday_mean_tmin_DBF+
# xlab(expression("SW"[IN]*" midday mean (W m"^-2*")"))+
xlab("")+
ylab("")
p_SW_midday_mean_tmin_MF<-p_SW_midday_mean_tmin_MF+
xlab(expression("SW"[IN]*" midday mean (W m"^-2*")"))+
ylab(expression("T"[min]*" (°C)"))
p_SW_midday_mean_tmin_ENF<-p_SW_midday_mean_tmin_ENF+
ylab("")+
xlab(expression("SW"[IN]*" midday mean (W m"^-2*")"))
#
p_ppfd_midday_mean_tmin_DBF<-p_ppfd_midday_mean_tmin_DBF+
xlab("")+
ylab("")
# xlab(expression("PAR (umol m"^-2*"s"^-1*")"))
p_ppfd_midday_mean_tmin_MF<-p_ppfd_midday_mean_tmin_MF+
xlab(expression("PAR midday mean (umol m"^-2*"s"^-1*")"))+
ylab(expression("T"[min]*" (°C)"))
p_ppfd_midday_mean_tmin_ENF<-p_ppfd_midday_mean_tmin_ENF+
ylab("")+
xlab(expression("PAR midday mean (umol m"^-2*"s"^-1*")"))
#B. merge the plots and save:
save.path<-"./manuscript/figures/"
p_SW_IN_Tmin<-plot_grid(p_SW_midday_mean_tmin_all,p_SW_midday_mean_tmin_DBF,
p_SW_midday_mean_tmin_MF,p_SW_midday_mean_tmin_ENF,
nrow = 2,ncol=2,labels = "auto",label_size = 20,align = "hv")
p_SW_IN_Tmin
ggsave(paste0(save.path,"Figure3_boxplot_SW_Tmin.png"),p_SW_IN_Tmin,width = 23,height = 19)
#-----------------
#start plotting
#----------------
comp_boxplot<-function(df,comp_yvar,do_legend,end_xylab,PFT_name){
# df<-df_bins_SW_IN_all
# comp_yvar<-c("temp_min_fluxnet2015")
# do_legend<-FALSE
# end_xylab<-c("SW_IN midday mean (W m-2)","")
# PFT_name<-"All PFTs"
#------------------------------------
#plotting
#------------------------------------
##
df.tidy<-df[,c("sitename","date",comp_yvar,"inbin","year_flag")]
names(df.tidy)<-c("sitename","date","comp_vary","inbin","year_flag")
#remove the rows when inbin ==NA
df.tidy<-df.tidy[!is.na(df.tidy$inbin),]
##
p_plot_main<-ggplot(df.tidy,aes(x = inbin, y = comp_vary,fill=year_flag))+
geom_boxplot()+
# annotate("rect",xmin=0,xmax=70,ymin = -Inf,ymax = Inf,alpha=0.2)+  #
scale_fill_manual("",values = c("SY_OSB"=adjustcolor("tomato",1),
"SY_ASB"=adjustcolor("dodgerblue",1)))+
geom_hline(yintercept = 0,linetype="dotted",size=1.1)+
theme_classic()+
theme(legend.position = c(0.15,0.99),legend.background = element_blank(),
legend.text = element_text(size=24),
axis.title = element_text(size = 30),
axis.text = element_text(size = 24),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank())+
rotate_x_text(30)+
ylim(-45,28)+
xlab(end_xylab[1])+
ylab(end_xylab[2])
if(comp_yvar=="alpha_SW"|comp_yvar=="alpha_PPFD"){
p_plot_main<-p_plot_main+
ylim(0,1)
}
#legend
if(do_legend==FALSE){
p_plot_main<-p_plot_main+
theme(legend.position = "none")
}
#add the PFT name:
p_plot_main<-p_plot_main+
ggtitle(PFT_name)+
theme(title = element_text(size = 28))
# N_x<-length(unique(df.tidy$inbin))
# p_plot_main<-p_plot_main+
#   annotate(geom = "text",x=N_x/1.7,y=28,label=PFT_name,col="blue",size=10)
#
return(p_plot_main)
}
#A1a).classification:
df_bins_SW_IN_all<-Classify_Nbins_andPlot(df_len5_nonnorm,c(-60,70),"SW_IN_midday_mean_fluxnet2015",8,FALSE,"All PFTs")
#change "ppfd_fluxnet2015" to "PPFD_IN_fullday_mean_fluxnet2015"/PPFD_IN_midday_mean_fluxnet2015
df_bins_ppfd_all<-Classify_Nbins_andPlot(df_len5_nonnorm,c(-60,80),"PPFD_IN_fullday_mean_fluxnet2015",8,FALSE,"All PFTs")
#A1b).plotting--->update in March,2022
#----------------
##For SW
#SW_midday_mean and tmin
p_SW_midday_mean_tmin_all<-comp_boxplot(df_bins_SW_IN_all,c("temp_min_fluxnet2015"),TRUE,
c("SW_IN midday mean (W m-2)","Minimum Ta (°C)"),"All PFTs")
#SW_midday_mean and max
p_SW_midday_mean_tmax_all<-comp_boxplot(df_bins_SW_IN_all,c("temp_max_fluxnet2015"),FALSE,
c("SW_IN middday mean (W m-2)","Maximum Ta (°C)"),"All PFTs")
#SW_midday_mean and tmean
p_SW_midday_mean_tmean_all<-comp_boxplot(df_bins_SW_IN_all,c("temp_day_fluxnet2015"),FALSE,
c("SW_IN middday mean (W m-2)","mean Ta (°C)"),"All PFTs")
#tmin and alpha_SW
p_SW_midday_mean_alpha_SW_all<-comp_boxplot(df_bins_SW_IN_all,c("alpha_SW"),FALSE,c("SW_IN middday mean (W m-2)","alpha_SW"),"All PFTs")
# tmin and alpha_PPFD
# p_SW_midday_mean_alpha_PPFD<-comp_boxplot(df_bins_SW_IN,c("alpha_PPFD"),FALSE,c("SW_IN middday mean (W m-2)","alpha_PPFD"))
#-------------
##For ppfd
p_ppfd_midday_mean_tmin_all<-comp_boxplot(df_bins_ppfd_all,c("temp_min_fluxnet2015"),TRUE,
c("PAR midday mean (umol m-2 s-1)","Minimum Ta (°C)"),"All PFTs")
p_ppfd_midday_alpha_PPFD_all<-comp_boxplot(df_bins_ppfd_all,c("alpha_PPFD"),FALSE,
c("PAR middday mean (W m-2)","alpha_PPFD"),"All PFTs")
#------------------------------
#A1c).change the labels
p_SW_midday_mean_tmin_all<-p_SW_midday_mean_tmin_all+
xlab("")+
ylab(expression("T"[min]*" (°C)"))
p_ppfd_midday_mean_tmin_all<-p_ppfd_midday_mean_tmin_all+
xlab("")+
ylab(expression("T"[min]*" (°C)"))
########
#A2.For different PFTs:DBF, MF, and ENF
########
df_bins_SW_IN_DBF<-Classify_Nbins_andPlot(df_len5_nonnorm,c(-60,70),"SW_IN_midday_mean_fluxnet2015",8,FALSE,"DBF")
df_bins_SW_IN_MF<-Classify_Nbins_andPlot(df_len5_nonnorm,c(-60,70),"SW_IN_midday_mean_fluxnet2015",8,FALSE,"MF")
df_bins_SW_IN_ENF<-Classify_Nbins_andPlot(df_len5_nonnorm,c(-60,70),"SW_IN_midday_mean_fluxnet2015",8,FALSE,"ENF")
#
df_bins_ppfd_DBF<-Classify_Nbins_andPlot(df_len5_nonnorm,c(-60,80),"PPFD_IN_fullday_mean_fluxnet2015",8,FALSE,"DBF")
df_bins_ppfd_MF<-Classify_Nbins_andPlot(df_len5_nonnorm,c(-60,80),"PPFD_IN_fullday_mean_fluxnet2015",8,FALSE,"MF")
df_bins_ppfd_ENF<-Classify_Nbins_andPlot(df_len5_nonnorm,c(-60,80),"PPFD_IN_fullday_mean_fluxnet2015",8,FALSE,"ENF")
##For SW
p_SW_midday_mean_tmin_DBF<-comp_boxplot(df_bins_SW_IN_DBF,c("temp_min_fluxnet2015"),FALSE,
c("SW_IN midday mean (W m-2)","Minimum Ta (°C)"),"DBF")
p_SW_midday_mean_tmin_MF<-comp_boxplot(df_bins_SW_IN_MF,c("temp_min_fluxnet2015"),FALSE,
c("SW_IN midday mean (W m-2)","Minimum Ta (°C)"),"MF")
p_SW_midday_mean_tmin_ENF<-comp_boxplot(df_bins_SW_IN_ENF,c("temp_min_fluxnet2015"),FALSE,
c("SW_IN midday mean (W m-2)","Minimum Ta (°C)"),"ENF")
##For ppfd
p_ppfd_midday_mean_tmin_DBF<-comp_boxplot(df_bins_ppfd_DBF,c("temp_min_fluxnet2015"),FALSE,
c("PAR midday mean (umol m-2 s-1)","Minimum Ta (°C)"),"DBF")
p_ppfd_midday_mean_tmin_MF<-comp_boxplot(df_bins_ppfd_MF,c("temp_min_fluxnet2015"),FALSE,
c("PAR midday mean (umol m-2 s-1)","Minimum Ta (°C)"),"MF")
p_ppfd_midday_mean_tmin_ENF<-comp_boxplot(df_bins_ppfd_ENF,c("temp_min_fluxnet2015"),FALSE,
c("PAR midday mean (umol m-2 s-1)","Minimum Ta (°C)"),"ENF")
#for albedo:
p_SW_midday_mean_alpha_SW_DBF<-comp_boxplot(df_bins_SW_IN_all,c("alpha_SW"),FALSE,c("SW_IN middday mean (W m-2)","alpha_SW"),"DBF")
p_ppfd_midday_alpha_PPFD_DBF<-comp_boxplot(df_bins_ppfd_all,c("alpha_PPFD"),FALSE,
c("PAR middday mean (W m-2)","alpha_PPFD"),"DBF")
p_SW_midday_mean_alpha_SW_MF<-comp_boxplot(df_bins_SW_IN_all,c("alpha_SW"),FALSE,c("SW_IN middday mean (W m-2)","alpha_SW"),"MF")
p_ppfd_midday_alpha_PPFD_MF<-comp_boxplot(df_bins_ppfd_all,c("alpha_PPFD"),FALSE,
c("PAR middday mean (W m-2)","alpha_PPFD"),"MF")
p_SW_midday_mean_alpha_SW_ENF<-comp_boxplot(df_bins_SW_IN_all,c("alpha_SW"),FALSE,c("SW_IN middday mean (W m-2)","alpha_SW"),"ENF")
p_ppfd_midday_alpha_PPFD_ENF<-comp_boxplot(df_bins_ppfd_all,c("alpha_PPFD"),FALSE,
c("PAR middday mean (W m-2)","alpha_PPFD"),"ENF")
#change the labels
#
p_SW_midday_mean_tmin_DBF<-p_SW_midday_mean_tmin_DBF+
# xlab(expression("SW"[IN]*" midday mean (W m"^-2*")"))+
xlab("")+
ylab("")
p_SW_midday_mean_tmin_MF<-p_SW_midday_mean_tmin_MF+
xlab(expression("SW"[IN]*" midday mean (W m"^-2*")"))+
ylab(expression("T"[min]*" (°C)"))
p_SW_midday_mean_tmin_ENF<-p_SW_midday_mean_tmin_ENF+
ylab("")+
xlab(expression("SW"[IN]*" midday mean (W m"^-2*")"))
#
p_ppfd_midday_mean_tmin_DBF<-p_ppfd_midday_mean_tmin_DBF+
xlab("")+
ylab("")
# xlab(expression("PAR (umol m"^-2*"s"^-1*")"))
p_ppfd_midday_mean_tmin_MF<-p_ppfd_midday_mean_tmin_MF+
xlab(expression("PAR midday mean (umol m"^-2*"s"^-1*")"))+
ylab(expression("T"[min]*" (°C)"))
p_ppfd_midday_mean_tmin_ENF<-p_ppfd_midday_mean_tmin_ENF+
ylab("")+
xlab(expression("PAR midday mean (umol m"^-2*"s"^-1*")"))
#B. merge the plots and save:
save.path<-"./manuscript/figures/"
p_SW_IN_Tmin<-plot_grid(p_SW_midday_mean_tmin_all,p_SW_midday_mean_tmin_DBF,
p_SW_midday_mean_tmin_MF,p_SW_midday_mean_tmin_ENF,
nrow = 2,ncol=2,labels = "auto",label_size = 20,align = "hv")
ggsave(paste0(save.path,"Figure3_boxplot_SW_Tmin.png"),p_SW_IN_Tmin,width = 23,height = 19)
#-----------------
#start plotting
#----------------
comp_boxplot<-function(df,comp_yvar,do_legend,end_xylab,PFT_name){
# df<-df_bins_SW_IN_all
# comp_yvar<-c("temp_min_fluxnet2015")
# do_legend<-FALSE
# end_xylab<-c("SW_IN midday mean (W m-2)","")
# PFT_name<-"All PFTs"
#------------------------------------
#plotting
#------------------------------------
##
df.tidy<-df[,c("sitename","date",comp_yvar,"inbin","year_flag")]
names(df.tidy)<-c("sitename","date","comp_vary","inbin","year_flag")
#remove the rows when inbin ==NA
df.tidy<-df.tidy[!is.na(df.tidy$inbin),]
##
p_plot_main<-ggplot(df.tidy,aes(x = inbin, y = comp_vary,fill=year_flag))+
geom_boxplot()+
# annotate("rect",xmin=0,xmax=70,ymin = -Inf,ymax = Inf,alpha=0.2)+  #
scale_fill_manual("",values = c("SY_OSB"=adjustcolor("tomato",1),
"SY_ASB"=adjustcolor("dodgerblue",1)))+
geom_hline(yintercept = 0,linetype="dotted",size=1.1)+
theme_classic()+
theme(legend.position = c(0.10,0.99),legend.background = element_blank(),
legend.text = element_text(size=24),
axis.title = element_text(size = 30),
axis.text = element_text(size = 24),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank())+
rotate_x_text(30)+
ylim(-45,28)+
xlab(end_xylab[1])+
ylab(end_xylab[2])
if(comp_yvar=="alpha_SW"|comp_yvar=="alpha_PPFD"){
p_plot_main<-p_plot_main+
ylim(0,1)
}
#legend
if(do_legend==FALSE){
p_plot_main<-p_plot_main+
theme(legend.position = "none")
}
#add the PFT name:
p_plot_main<-p_plot_main+
ggtitle(PFT_name)+
theme(title = element_text(size = 28))
# N_x<-length(unique(df.tidy$inbin))
# p_plot_main<-p_plot_main+
#   annotate(geom = "text",x=N_x/1.7,y=28,label=PFT_name,col="blue",size=10)
#
return(p_plot_main)
}
#A1a).classification:
df_bins_SW_IN_all<-Classify_Nbins_andPlot(df_len5_nonnorm,c(-60,70),"SW_IN_midday_mean_fluxnet2015",8,FALSE,"All PFTs")
#change "ppfd_fluxnet2015" to "PPFD_IN_fullday_mean_fluxnet2015"/PPFD_IN_midday_mean_fluxnet2015
df_bins_ppfd_all<-Classify_Nbins_andPlot(df_len5_nonnorm,c(-60,80),"PPFD_IN_fullday_mean_fluxnet2015",8,FALSE,"All PFTs")
#A1b).plotting--->update in March,2022
#----------------
##For SW
#SW_midday_mean and tmin
p_SW_midday_mean_tmin_all<-comp_boxplot(df_bins_SW_IN_all,c("temp_min_fluxnet2015"),TRUE,
c("SW_IN midday mean (W m-2)","Minimum Ta (°C)"),"All PFTs")
#SW_midday_mean and max
p_SW_midday_mean_tmax_all<-comp_boxplot(df_bins_SW_IN_all,c("temp_max_fluxnet2015"),FALSE,
c("SW_IN middday mean (W m-2)","Maximum Ta (°C)"),"All PFTs")
#SW_midday_mean and tmean
p_SW_midday_mean_tmean_all<-comp_boxplot(df_bins_SW_IN_all,c("temp_day_fluxnet2015"),FALSE,
c("SW_IN middday mean (W m-2)","mean Ta (°C)"),"All PFTs")
#tmin and alpha_SW
p_SW_midday_mean_alpha_SW_all<-comp_boxplot(df_bins_SW_IN_all,c("alpha_SW"),FALSE,c("SW_IN middday mean (W m-2)","alpha_SW"),"All PFTs")
# tmin and alpha_PPFD
# p_SW_midday_mean_alpha_PPFD<-comp_boxplot(df_bins_SW_IN,c("alpha_PPFD"),FALSE,c("SW_IN middday mean (W m-2)","alpha_PPFD"))
#-------------
##For ppfd
p_ppfd_midday_mean_tmin_all<-comp_boxplot(df_bins_ppfd_all,c("temp_min_fluxnet2015"),TRUE,
c("PAR midday mean (umol m-2 s-1)","Minimum Ta (°C)"),"All PFTs")
p_ppfd_midday_alpha_PPFD_all<-comp_boxplot(df_bins_ppfd_all,c("alpha_PPFD"),FALSE,
c("PAR middday mean (W m-2)","alpha_PPFD"),"All PFTs")
#------------------------------
#A1c).change the labels
p_SW_midday_mean_tmin_all<-p_SW_midday_mean_tmin_all+
xlab("")+
ylab(expression("T"[min]*" (°C)"))
p_ppfd_midday_mean_tmin_all<-p_ppfd_midday_mean_tmin_all+
xlab("")+
ylab(expression("T"[min]*" (°C)"))
########
#A2.For different PFTs:DBF, MF, and ENF
########
df_bins_SW_IN_DBF<-Classify_Nbins_andPlot(df_len5_nonnorm,c(-60,70),"SW_IN_midday_mean_fluxnet2015",8,FALSE,"DBF")
df_bins_SW_IN_MF<-Classify_Nbins_andPlot(df_len5_nonnorm,c(-60,70),"SW_IN_midday_mean_fluxnet2015",8,FALSE,"MF")
df_bins_SW_IN_ENF<-Classify_Nbins_andPlot(df_len5_nonnorm,c(-60,70),"SW_IN_midday_mean_fluxnet2015",8,FALSE,"ENF")
#
df_bins_ppfd_DBF<-Classify_Nbins_andPlot(df_len5_nonnorm,c(-60,80),"PPFD_IN_fullday_mean_fluxnet2015",8,FALSE,"DBF")
df_bins_ppfd_MF<-Classify_Nbins_andPlot(df_len5_nonnorm,c(-60,80),"PPFD_IN_fullday_mean_fluxnet2015",8,FALSE,"MF")
df_bins_ppfd_ENF<-Classify_Nbins_andPlot(df_len5_nonnorm,c(-60,80),"PPFD_IN_fullday_mean_fluxnet2015",8,FALSE,"ENF")
##For SW
p_SW_midday_mean_tmin_DBF<-comp_boxplot(df_bins_SW_IN_DBF,c("temp_min_fluxnet2015"),FALSE,
c("SW_IN midday mean (W m-2)","Minimum Ta (°C)"),"DBF")
p_SW_midday_mean_tmin_MF<-comp_boxplot(df_bins_SW_IN_MF,c("temp_min_fluxnet2015"),FALSE,
c("SW_IN midday mean (W m-2)","Minimum Ta (°C)"),"MF")
p_SW_midday_mean_tmin_ENF<-comp_boxplot(df_bins_SW_IN_ENF,c("temp_min_fluxnet2015"),FALSE,
c("SW_IN midday mean (W m-2)","Minimum Ta (°C)"),"ENF")
##For ppfd
p_ppfd_midday_mean_tmin_DBF<-comp_boxplot(df_bins_ppfd_DBF,c("temp_min_fluxnet2015"),FALSE,
c("PAR midday mean (umol m-2 s-1)","Minimum Ta (°C)"),"DBF")
p_ppfd_midday_mean_tmin_MF<-comp_boxplot(df_bins_ppfd_MF,c("temp_min_fluxnet2015"),FALSE,
c("PAR midday mean (umol m-2 s-1)","Minimum Ta (°C)"),"MF")
p_ppfd_midday_mean_tmin_ENF<-comp_boxplot(df_bins_ppfd_ENF,c("temp_min_fluxnet2015"),FALSE,
c("PAR midday mean (umol m-2 s-1)","Minimum Ta (°C)"),"ENF")
#for albedo:
p_SW_midday_mean_alpha_SW_DBF<-comp_boxplot(df_bins_SW_IN_all,c("alpha_SW"),FALSE,c("SW_IN middday mean (W m-2)","alpha_SW"),"DBF")
p_ppfd_midday_alpha_PPFD_DBF<-comp_boxplot(df_bins_ppfd_all,c("alpha_PPFD"),FALSE,
c("PAR middday mean (W m-2)","alpha_PPFD"),"DBF")
p_SW_midday_mean_alpha_SW_MF<-comp_boxplot(df_bins_SW_IN_all,c("alpha_SW"),FALSE,c("SW_IN middday mean (W m-2)","alpha_SW"),"MF")
p_ppfd_midday_alpha_PPFD_MF<-comp_boxplot(df_bins_ppfd_all,c("alpha_PPFD"),FALSE,
c("PAR middday mean (W m-2)","alpha_PPFD"),"MF")
p_SW_midday_mean_alpha_SW_ENF<-comp_boxplot(df_bins_SW_IN_all,c("alpha_SW"),FALSE,c("SW_IN middday mean (W m-2)","alpha_SW"),"ENF")
p_ppfd_midday_alpha_PPFD_ENF<-comp_boxplot(df_bins_ppfd_all,c("alpha_PPFD"),FALSE,
c("PAR middday mean (W m-2)","alpha_PPFD"),"ENF")
#change the labels
#
p_SW_midday_mean_tmin_DBF<-p_SW_midday_mean_tmin_DBF+
# xlab(expression("SW"[IN]*" midday mean (W m"^-2*")"))+
xlab("")+
ylab("")
p_SW_midday_mean_tmin_MF<-p_SW_midday_mean_tmin_MF+
xlab(expression("SW"[IN]*" midday mean (W m"^-2*")"))+
ylab(expression("T"[min]*" (°C)"))
p_SW_midday_mean_tmin_ENF<-p_SW_midday_mean_tmin_ENF+
ylab("")+
xlab(expression("SW"[IN]*" midday mean (W m"^-2*")"))
#
p_ppfd_midday_mean_tmin_DBF<-p_ppfd_midday_mean_tmin_DBF+
xlab("")+
ylab("")
# xlab(expression("PAR (umol m"^-2*"s"^-1*")"))
p_ppfd_midday_mean_tmin_MF<-p_ppfd_midday_mean_tmin_MF+
xlab(expression("PAR midday mean (umol m"^-2*"s"^-1*")"))+
ylab(expression("T"[min]*" (°C)"))
p_ppfd_midday_mean_tmin_ENF<-p_ppfd_midday_mean_tmin_ENF+
ylab("")+
xlab(expression("PAR midday mean (umol m"^-2*"s"^-1*")"))
#B. merge the plots and save:
save.path<-"./manuscript/figures/"
p_SW_IN_Tmin<-plot_grid(p_SW_midday_mean_tmin_all,p_SW_midday_mean_tmin_DBF,
p_SW_midday_mean_tmin_MF,p_SW_midday_mean_tmin_ENF,
nrow = 2,ncol=2,labels = "auto",label_size = 20,align = "hv")
ggsave(paste0(save.path,"Figure3_boxplot_SW_Tmin.png"),p_SW_IN_Tmin,width = 23,height = 19)
#
p_ppfd_Tmin<-plot_grid(p_ppfd_midday_mean_tmin_all,p_ppfd_midday_mean_tmin_DBF,
p_ppfd_midday_mean_tmin_MF,p_ppfd_midday_mean_tmin_ENF,
nrow = 2,ncol=2,labels = "auto",label_size = 20,align = "hv")
ggsave(paste0(save.path,"FigureS_boxplot_ppfd_Tmin.png"),p_ppfd_Tmin,width = 25,height = 19)
#test albedo
p_albedo1<-plot_grid(p_SW_midday_mean_alpha_SW_all,p_SW_midday_mean_alpha_SW_DBF,
p_SW_midday_mean_alpha_SW_MF,p_SW_midday_mean_alpha_SW_ENF,
nrow = 2,ncol=2)
p_albedo2<-plot_grid(p_ppfd_midday_alpha_PPFD_all,p_ppfd_midday_alpha_PPFD_DBF,
p_ppfd_midday_alpha_PPFD_MF,p_ppfd_midday_alpha_PPFD_ENF,
nrow = 2,ncol=2)
