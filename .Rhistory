#III.PFT level---
df_PFT_level<-df_site_level %>%
group_by(PFT)%>%
summarise(tmin=mean(tmin,na.rm=T),
tmean=mean(tmean,na.rm=T))
par_PFT_level<-df_paras[df_paras$flag=="PFT",] %>%
mutate(sitename=NULL,Clim_PFTs=NULL,flag=NULL)%>%
filter(parameter==para)
par_PFT_level<-par_PFT_level[,-1]
names(par_PFT_level)<-c("para","PFT")
#
df_PFT_level_new<-left_join(df_PFT_level,par_PFT_level)
#
t_pos<-match(Env_var,names(df_PFT_level_new))
names(df_PFT_level_new)[t_pos]<-"Env_var"
##----plotting----##
pars_final<-ggplot()+
geom_point(data=df_site_level_new,aes(x=Env_var,y=para,shape=PFT,size="site"))+
ggforce::geom_mark_ellipse(data=df_site_level_new,
aes(x=Env_var,y=para,label=PFT,shape=PFT),label.fill = "grey",
con.border = "one",con.cap = 0,con.size = 1.1,
con.arrow = grid::arrow(angle=30,ends = "last",length = unit(0.1,"inches")))+  ##site-level
geom_point(data=df_Clim_PFT_level_new,
aes(x=Env_var,y=para,shape=PFT,col=Clim,size="Clim-PFT"),alpha=0.5)+ ##Clim-PFT level
geom_point(data=df_PFT_level_new,
aes(x=Env_var,y=para,shape=PFT,size="PFT"),col="blue",alpha=0.5)+##PFT level
scale_size_manual("",values = c("site"=3,"Clim-PFT"=6,"PFT"=12))+
xlab(paste0(Env_var," (°C)"))+
ylab(paste0(para," (°C)"))+
theme(
legend.text = element_text(size=22),
legend.key.size = unit(2, 'lines'),
axis.title = element_text(size=26),
axis.text = element_text(size = 22),
text = element_text(size=24),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_rect(colour ="grey",fill="white")
)
if(do_legend==FALSE){
pars_final<-pars_final+
theme(legend.position = "none")
}
#
return(pars_final)
}
p_tmin_a1<-plot_paras(df_meteo = df_final_new,df_paras = data_sel_final,Env_var = "tmin",
para = "a1",FALSE)
p_tmean_b1<-plot_paras(df_meteo = df_final_new,df_paras = data_sel_final,Env_var = "tmean",
para = "b1",FALSE)
p_tmin_a2<-plot_paras(df_meteo = df_final_new,df_paras = data_sel_final,Env_var = "tmin",
para = "a2",FALSE)
p_tmean_b2<-plot_paras(df_meteo = df_final_new,df_paras = data_sel_final,Env_var = "tmean",
para = "b2",FALSE)
p_tmean_k<-plot_paras(df_meteo = df_final_new,df_paras = data_sel_final,Env_var = "tmean",
para = "k",TRUE)
#change the x labels:
p_tmin_a1<-p_tmin_a1+xlab(expression("T"[min]*" (°C)"))
p_tmean_b1<-p_tmean_b1+xlab(expression("T"[mean]*" (°C)"))
p_tmin_a2<-p_tmin_a2+xlab(expression("T"[min]*" (°C)"))
p_tmean_b2<-p_tmean_b2+xlab(expression("T"[mean]*" (°C)"))
p_tmean_k<-p_tmean_k+xlab(expression("T"[mean]*" (°C)"))+
theme(legend.position = c(1.7,0.4),
legend.spacing.y = unit(0.4, 'cm'))+
guides(size=guide_legend(ncol=3,byrow=T))+
guides(col=guide_legend(ncol = 4,byrow = T))+
guides(shape=guide_legend(ncol = 3,byrow = T))
#merge the plots:
paras_range<-cowplot::plot_grid(p_tmin_a1,p_tmean_b1,p_tmin_a2,p_tmean_b2,p_tmean_k,
nrow = 3,ncol=2,labels = "auto",label_size = 20,align = "hv")
######save the plot###########
save.path<-"./manuscript/figures/"
ggsave(paste0(save.path,"Figure7_parameters_ranges.png"),paras_range,height = 18,width = 20)
p_tmean_k<-p_tmean_k+xlab(expression("T"[mean]*" (°C)"))+
theme(legend.position = c(1.7,0.4),
legend.spacing.y = unit(0.4, 'cm'),
legend.key.size = 2)+
guides(size=guide_legend(ncol=3,byrow=T))+
guides(col=guide_legend(ncol = 4,byrow = T))+
guides(shape=guide_legend(ncol = 3,byrow = T))
#merge the plots:
paras_range<-cowplot::plot_grid(p_tmin_a1,p_tmean_b1,p_tmin_a2,p_tmean_b2,p_tmean_k,
nrow = 3,ncol=2,labels = "auto",label_size = 20,align = "hv")
######save the plot###########
save.path<-"./manuscript/figures/"
ggsave(paste0(save.path,"Figure7_parameters_ranges.png"),paras_range,height = 18,width = 20)
p_tmean_k<-p_tmean_k+xlab(expression("T"[mean]*" (°C)"))+
theme(legend.position = c(1.7,0.4),
legend.spacing.y = unit(0.4, 'cm'),
legend.key.size = unit(2,"cm"))+
guides(size=guide_legend(ncol=3,byrow=T))+
guides(col=guide_legend(ncol = 4,byrow = T))+
guides(shape=guide_legend(ncol = 3,byrow = T))
#merge the plots:
paras_range<-cowplot::plot_grid(p_tmin_a1,p_tmean_b1,p_tmin_a2,p_tmean_b2,p_tmean_k,
nrow = 3,ncol=2,labels = "auto",label_size = 20,align = "hv")
######save the plot###########
save.path<-"./manuscript/figures/"
ggsave(paste0(save.path,"Figure7_parameters_ranges.png"),paras_range,height = 18,width = 20)
p_tmean_k+xlab(expression("T"[mean]*" (°C)"))+
theme(legend.position = c(1.7,0.4),
legend.spacing.y = unit(0.4, 'cm'),
legend.key.size = unit(2,"cm"))+
guides(size=guide_legend(ncol=3,byrow=T,override.aes = list(size = 3)))+
guides(col=guide_legend(ncol = 4,byrow = T))+
guides(shape=guide_legend(ncol = 3,byrow = T))
p_tmean_k+xlab(expression("T"[mean]*" (°C)"))+
theme(legend.position = c(1.7,0.4),
legend.spacing.y = unit(0.4, 'cm'),
legend.key.size = unit(2,"cm"))+
guides(size=guide_legend(ncol=3,byrow=T,override.aes = list(size = 3)))+
guides(col=guide_legend(ncol = 4,byrow = T,override.aes = list(size = 3)))+
guides(shape=guide_legend(ncol = 3,byrow = T,override.aes = list(size = 3)))
p_tmean_k<-p_tmean_k+xlab(expression("T"[mean]*" (°C)"))+
theme(legend.position = c(1.7,0.4),
legend.spacing.y = unit(0.4, 'cm'),
legend.key.size = unit(2,"cm"))+
guides(size=guide_legend(ncol=3,byrow=T,override.aes = list(size = 3)))+
guides(col=guide_legend(ncol = 4,byrow = T,override.aes = list(size = 3)))+
guides(shape=guide_legend(ncol = 3,byrow = T,override.aes = list(size = 3)))
p_tmean_k<-plot_paras(df_meteo = df_final_new,df_paras = data_sel_final,Env_var = "tmean",
para = "k",TRUE)
#change the x labels:
p_tmin_a1<-p_tmin_a1+xlab(expression("T"[min]*" (°C)"))
p_tmean_b1<-p_tmean_b1+xlab(expression("T"[mean]*" (°C)"))
p_tmin_a2<-p_tmin_a2+xlab(expression("T"[min]*" (°C)"))
p_tmean_b2<-p_tmean_b2+xlab(expression("T"[mean]*" (°C)"))
p_tmean_k<-p_tmean_k+xlab(expression("T"[mean]*" (°C)"))+
theme(legend.position = c(1.7,0.4),
legend.spacing.y = unit(0.4, 'cm'),
legend.key.size = unit(2,"cm"))+
guides(size=guide_legend(ncol=3,byrow=T,override.aes = list(size = 3)))+
guides(col=guide_legend(ncol = 4,byrow = T,override.aes = list(size = 3)))+
guides(shape=guide_legend(ncol = 3,byrow = T,override.aes = list(size = 3)))
#merge the plots:
paras_range<-cowplot::plot_grid(p_tmin_a1,p_tmean_b1,p_tmin_a2,p_tmean_b2,p_tmean_k,
nrow = 3,ncol=2,labels = "auto",label_size = 20,align = "hv")
######save the plot###########
save.path<-"./manuscript/figures/"
ggsave(paste0(save.path,"Figure7_parameters_ranges.png"),paras_range,height = 18,width = 20)
p_tmean_k<-p_tmean_k+xlab(expression("T"[mean]*" (°C)"))+
theme(legend.position = c(1.7,0.4),
legend.spacing.y = unit(0.4, 'cm'),
legend.key.size = unit(2,"cm"))+
guides(size=guide_legend(ncol=3,byrow=T,override.aes = list(size = 3)))+
guides(col=guide_legend(ncol = 4,byrow = T,override.aes = list(size = 3)))+
guides(shape=guide_legend(ncol = 3,byrow = T))
#merge the plots:
paras_range<-cowplot::plot_grid(p_tmin_a1,p_tmean_b1,p_tmin_a2,p_tmean_b2,p_tmean_k,
nrow = 3,ncol=2,labels = "auto",label_size = 20,align = "hv")
######save the plot###########
save.path<-"./manuscript/figures/"
ggsave(paste0(save.path,"Figure7_parameters_ranges.png"),paras_range,height = 18,width = 20)
p_tmean_k<-p_tmean_k+xlab(expression("T"[mean]*" (°C)"))+
theme(legend.position = c(1.7,0.4),
legend.spacing.y = unit(0.4, 'cm'),
legend.key.size = unit(2,"cm"))+
guides(size=guide_legend(ncol=3,byrow=T))+
guides(col=guide_legend(ncol = 4,byrow = T,override.aes = list(size = 3)))+
guides(shape=guide_legend(ncol = 3,byrow = T,override.aes = list(size = 3)))
#merge the plots:
paras_range<-cowplot::plot_grid(p_tmin_a1,p_tmean_b1,p_tmin_a2,p_tmean_b2,p_tmean_k,
nrow = 3,ncol=2,labels = "auto",label_size = 20,align = "hv")
######save the plot###########
save.path<-"./manuscript/figures/"
ggsave(paste0(save.path,"Figure7_parameters_ranges.png"),paras_range,height = 18,width = 20)
p_tmean_k<-p_tmean_k+xlab(expression("T"[mean]*" (°C)"))+
theme(legend.position = c(1.7,0.4),
legend.spacing.y = unit(0.4, 'cm'),
legend.key.size = unit(2,"cm"))+
guides(size=guide_legend(ncol=3,byrow=T))+
guides(col=guide_legend(ncol = 4,byrow = T,override.aes = list(size = 6)))+
guides(shape=guide_legend(ncol = 3,byrow = T,override.aes = list(size = 6)))
#merge the plots:
paras_range<-cowplot::plot_grid(p_tmin_a1,p_tmean_b1,p_tmin_a2,p_tmean_b2,p_tmean_k,
nrow = 3,ncol=2,labels = "auto",label_size = 20,align = "hv")
######save the plot###########
save.path<-"./manuscript/figures/"
ggsave(paste0(save.path,"Figure7_parameters_ranges.png"),paras_range,height = 18,width = 20)
plot_paras<-function(df_meteo,df_paras,Env_var,para,do_legend){
# df_meteo<-df_final_new
# df_paras<-data_sel_final
# Env_var<-"tmean"
# para<-"a1"
# do_legend=FALSE
# for example: Tmin vs a1
#I.site-level
df_site_level<-df_meteo %>%
select(sitename,classid,koeppen_code,Clim.PFTs,para,tmin,temp)
names(df_site_level)<-c("sitename","PFT","Clim.","Clim.PFTs","para","tmin","tmean")
#
t_pos<-match(Env_var,names(df_site_level))
df_site_level_new<-df_site_level
names(df_site_level_new)[t_pos]<-"Env_var"
#II.Clim-PFT level---
df_Clim_PFT_level<-df_site_level %>%
group_by(Clim.PFTs)%>%
summarise(tmin=mean(tmin,na.rm=T),
tmean=mean(tmean,na.rm=T))
#
par_Clim_PFT_level<-df_paras[df_paras$flag=="Clim-PFT",]
par_Clim_PFT_level<-par_Clim_PFT_level %>%
filter(parameter==para)%>%
mutate(sitename=NULL,PFT=NULL,flag=NULL,
Clim.PFTs=Clim_PFTs,Clim_PFTs=NULL,parameter=NULL)
names(par_Clim_PFT_level)<-c("para","Clim.PFTs")
#
df_Clim_PFT_level_new<-left_join(df_Clim_PFT_level,par_Clim_PFT_level)
df_Clim_PFT_level_new$Clim<-substr(df_Clim_PFT_level_new$Clim.PFTs,1,3)
df_Clim_PFT_level_new$Clim<-factor(df_Clim_PFT_level_new$Clim,
levels = c("Cfa","Cfb","Dfb","Dfc"))
df_Clim_PFT_level_new$PFT<-substr(df_Clim_PFT_level_new$Clim.PFTs,5,7)
df_Clim_PFT_level_new$PFT<-factor(df_Clim_PFT_level_new$PFT,levels = c("DBF","MF","ENF"))
#
t_pos<-match(Env_var,names(df_Clim_PFT_level_new))
names(df_Clim_PFT_level_new)[t_pos]<-"Env_var"
#III.PFT level---
df_PFT_level<-df_site_level %>%
group_by(PFT)%>%
summarise(tmin=mean(tmin,na.rm=T),
tmean=mean(tmean,na.rm=T))
par_PFT_level<-df_paras[df_paras$flag=="PFT",] %>%
mutate(sitename=NULL,Clim_PFTs=NULL,flag=NULL)%>%
filter(parameter==para)
par_PFT_level<-par_PFT_level[,-1]
names(par_PFT_level)<-c("para","PFT")
#
df_PFT_level_new<-left_join(df_PFT_level,par_PFT_level)
#
t_pos<-match(Env_var,names(df_PFT_level_new))
names(df_PFT_level_new)[t_pos]<-"Env_var"
##----plotting----##
pars_final<-ggplot()+
geom_point(data=df_site_level_new,aes(x=Env_var,y=para,shape=PFT,size="site"))+
ggforce::geom_mark_ellipse(data=df_site_level_new,
aes(x=Env_var,y=para,label=PFT,shape=PFT),label.fill = "grey",
con.border = "one",con.cap = 0,con.size = 1.1,
con.arrow = grid::arrow(angle=30,ends = "last",length = unit(0.1,"inches")))+  ##site-level
geom_point(data=df_Clim_PFT_level_new,
aes(x=Env_var,y=para,shape=PFT,col=Clim,size="Clim-PFT"),alpha=0.5)+ ##Clim-PFT level
geom_point(data=df_PFT_level_new,
aes(x=Env_var,y=para,shape=PFT,size="PFT"),col="blue",alpha=0.5)+##PFT level
scale_size_manual("",values = c("site"=5,"Clim-PFT"=8,"PFT"=15))+
xlab(paste0(Env_var," (°C)"))+
ylab(paste0(para," (°C)"))+
theme(
legend.text = element_text(size=22),
legend.key.size = unit(2, 'lines'),
axis.title = element_text(size=26),
axis.text = element_text(size = 22),
text = element_text(size=24),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_rect(colour ="grey",fill="white")
)
if(do_legend==FALSE){
pars_final<-pars_final+
theme(legend.position = "none")
}
#
return(pars_final)
}
p_tmin_a1<-plot_paras(df_meteo = df_final_new,df_paras = data_sel_final,Env_var = "tmin",
para = "a1",FALSE)
p_tmean_b1<-plot_paras(df_meteo = df_final_new,df_paras = data_sel_final,Env_var = "tmean",
para = "b1",FALSE)
p_tmin_a2<-plot_paras(df_meteo = df_final_new,df_paras = data_sel_final,Env_var = "tmin",
para = "a2",FALSE)
p_tmean_b2<-plot_paras(df_meteo = df_final_new,df_paras = data_sel_final,Env_var = "tmean",
para = "b2",FALSE)
p_tmean_k<-plot_paras(df_meteo = df_final_new,df_paras = data_sel_final,Env_var = "tmean",
para = "k",TRUE)
#change the x labels:
p_tmin_a1<-p_tmin_a1+xlab(expression("T"[min]*" (°C)"))
p_tmean_b1<-p_tmean_b1+xlab(expression("T"[mean]*" (°C)"))
p_tmin_a2<-p_tmin_a2+xlab(expression("T"[min]*" (°C)"))
p_tmean_b2<-p_tmean_b2+xlab(expression("T"[mean]*" (°C)"))
p_tmean_k<-p_tmean_k+xlab(expression("T"[mean]*" (°C)"))+
theme(legend.position = c(1.7,0.4),
legend.spacing.y = unit(0.4, 'cm'),
legend.key.size = unit(2,"cm"))+
guides(size=guide_legend(ncol=3,byrow=T))+
guides(col=guide_legend(ncol = 4,byrow = T,override.aes = list(size = 6)))+
guides(shape=guide_legend(ncol = 3,byrow = T,override.aes = list(size = 6)))
#merge the plots:
paras_range<-cowplot::plot_grid(p_tmin_a1,p_tmean_b1,p_tmin_a2,p_tmean_b2,p_tmean_k,
nrow = 3,ncol=2,labels = "auto",label_size = 20,align = "hv")
######save the plot###########
save.path<-"./manuscript/figures/"
ggsave(paste0(save.path,"Figure7_parameters_ranges.png"),paras_range,height = 18,width = 20)
plot_paras<-function(df_meteo,df_paras,Env_var,para,do_legend){
# df_meteo<-df_final_new
# df_paras<-data_sel_final
# Env_var<-"tmean"
# para<-"a1"
# do_legend=FALSE
# for example: Tmin vs a1
#I.site-level
df_site_level<-df_meteo %>%
select(sitename,classid,koeppen_code,Clim.PFTs,para,tmin,temp)
names(df_site_level)<-c("sitename","PFT","Clim.","Clim.PFTs","para","tmin","tmean")
#
t_pos<-match(Env_var,names(df_site_level))
df_site_level_new<-df_site_level
names(df_site_level_new)[t_pos]<-"Env_var"
#II.Clim-PFT level---
df_Clim_PFT_level<-df_site_level %>%
group_by(Clim.PFTs)%>%
summarise(tmin=mean(tmin,na.rm=T),
tmean=mean(tmean,na.rm=T))
#
par_Clim_PFT_level<-df_paras[df_paras$flag=="Clim-PFT",]
par_Clim_PFT_level<-par_Clim_PFT_level %>%
filter(parameter==para)%>%
mutate(sitename=NULL,PFT=NULL,flag=NULL,
Clim.PFTs=Clim_PFTs,Clim_PFTs=NULL,parameter=NULL)
names(par_Clim_PFT_level)<-c("para","Clim.PFTs")
#
df_Clim_PFT_level_new<-left_join(df_Clim_PFT_level,par_Clim_PFT_level)
df_Clim_PFT_level_new$Clim<-substr(df_Clim_PFT_level_new$Clim.PFTs,1,3)
df_Clim_PFT_level_new$Clim<-factor(df_Clim_PFT_level_new$Clim,
levels = c("Cfa","Cfb","Dfb","Dfc"))
df_Clim_PFT_level_new$PFT<-substr(df_Clim_PFT_level_new$Clim.PFTs,5,7)
df_Clim_PFT_level_new$PFT<-factor(df_Clim_PFT_level_new$PFT,levels = c("DBF","MF","ENF"))
#
t_pos<-match(Env_var,names(df_Clim_PFT_level_new))
names(df_Clim_PFT_level_new)[t_pos]<-"Env_var"
#III.PFT level---
df_PFT_level<-df_site_level %>%
group_by(PFT)%>%
summarise(tmin=mean(tmin,na.rm=T),
tmean=mean(tmean,na.rm=T))
par_PFT_level<-df_paras[df_paras$flag=="PFT",] %>%
mutate(sitename=NULL,Clim_PFTs=NULL,flag=NULL)%>%
filter(parameter==para)
par_PFT_level<-par_PFT_level[,-1]
names(par_PFT_level)<-c("para","PFT")
#
df_PFT_level_new<-left_join(df_PFT_level,par_PFT_level)
#
t_pos<-match(Env_var,names(df_PFT_level_new))
names(df_PFT_level_new)[t_pos]<-"Env_var"
##----plotting----##
pars_final<-ggplot()+
geom_point(data=df_site_level_new,aes(x=Env_var,y=para,shape=PFT,size="site"))+
ggforce::geom_mark_ellipse(data=df_site_level_new,
aes(x=Env_var,y=para,label=PFT,shape=PFT),label.fill = "grey",
con.border = "one",con.cap = 0,con.size = 1.1,
con.arrow = grid::arrow(angle=30,ends = "last",length = unit(0.1,"inches")))+  ##site-level
geom_point(data=df_Clim_PFT_level_new,
aes(x=Env_var,y=para,shape=PFT,col=Clim,size="Clim-PFT"),alpha=0.8)+ ##Clim-PFT level
geom_point(data=df_PFT_level_new,
aes(x=Env_var,y=para,shape=PFT,size="PFT"),col="blue",alpha=0.5)+##PFT level
scale_size_manual("",values = c("site"=5,"Clim-PFT"=8,"PFT"=15))+
xlab(paste0(Env_var," (°C)"))+
ylab(paste0(para," (°C)"))+
theme(
legend.text = element_text(size=22),
legend.key.size = unit(2, 'lines'),
axis.title = element_text(size=26),
axis.text = element_text(size = 22),
text = element_text(size=24),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_rect(colour ="grey",fill="white")
)
if(do_legend==FALSE){
pars_final<-pars_final+
theme(legend.position = "none")
}
#
return(pars_final)
}
p_tmin_a1<-plot_paras(df_meteo = df_final_new,df_paras = data_sel_final,Env_var = "tmin",
para = "a1",FALSE)
p_tmean_b1<-plot_paras(df_meteo = df_final_new,df_paras = data_sel_final,Env_var = "tmean",
para = "b1",FALSE)
p_tmin_a2<-plot_paras(df_meteo = df_final_new,df_paras = data_sel_final,Env_var = "tmin",
para = "a2",FALSE)
p_tmean_b2<-plot_paras(df_meteo = df_final_new,df_paras = data_sel_final,Env_var = "tmean",
para = "b2",FALSE)
p_tmean_k<-plot_paras(df_meteo = df_final_new,df_paras = data_sel_final,Env_var = "tmean",
para = "k",TRUE)
#change the x labels:
p_tmin_a1<-p_tmin_a1+xlab(expression("T"[min]*" (°C)"))
p_tmean_b1<-p_tmean_b1+xlab(expression("T"[mean]*" (°C)"))
p_tmin_a2<-p_tmin_a2+xlab(expression("T"[min]*" (°C)"))
p_tmean_b2<-p_tmean_b2+xlab(expression("T"[mean]*" (°C)"))
p_tmean_k<-p_tmean_k+xlab(expression("T"[mean]*" (°C)"))+
theme(legend.position = c(1.7,0.4),
legend.spacing.y = unit(0.4, 'cm'),
legend.key.size = unit(2,"cm"))+
guides(size=guide_legend(ncol=3,byrow=T))+
guides(col=guide_legend(ncol = 4,byrow = T,override.aes = list(size = 6)))+
guides(shape=guide_legend(ncol = 3,byrow = T,override.aes = list(size = 6)))
#merge the plots:
paras_range<-cowplot::plot_grid(p_tmin_a1,p_tmean_b1,p_tmin_a2,p_tmean_b2,p_tmean_k,
nrow = 3,ncol=2,labels = "auto",label_size = 20,align = "hv")
######save the plot###########
save.path<-"./manuscript/figures/"
ggsave(paste0(save.path,"Figure7_parameters_ranges.png"),paras_range,height = 18,width = 20)
plot_paras<-function(df_meteo,df_paras,Env_var,para,do_legend){
# df_meteo<-df_final_new
# df_paras<-data_sel_final
# Env_var<-"tmean"
# para<-"a1"
# do_legend=FALSE
# for example: Tmin vs a1
#I.site-level
df_site_level<-df_meteo %>%
select(sitename,classid,koeppen_code,Clim.PFTs,para,tmin,temp)
names(df_site_level)<-c("sitename","PFT","Clim.","Clim.PFTs","para","tmin","tmean")
#
t_pos<-match(Env_var,names(df_site_level))
df_site_level_new<-df_site_level
names(df_site_level_new)[t_pos]<-"Env_var"
#II.Clim-PFT level---
df_Clim_PFT_level<-df_site_level %>%
group_by(Clim.PFTs)%>%
summarise(tmin=mean(tmin,na.rm=T),
tmean=mean(tmean,na.rm=T))
#
par_Clim_PFT_level<-df_paras[df_paras$flag=="Clim-PFT",]
par_Clim_PFT_level<-par_Clim_PFT_level %>%
filter(parameter==para)%>%
mutate(sitename=NULL,PFT=NULL,flag=NULL,
Clim.PFTs=Clim_PFTs,Clim_PFTs=NULL,parameter=NULL)
names(par_Clim_PFT_level)<-c("para","Clim.PFTs")
#
df_Clim_PFT_level_new<-left_join(df_Clim_PFT_level,par_Clim_PFT_level)
df_Clim_PFT_level_new$Clim<-substr(df_Clim_PFT_level_new$Clim.PFTs,1,3)
df_Clim_PFT_level_new$Clim<-factor(df_Clim_PFT_level_new$Clim,
levels = c("Cfa","Cfb","Dfb","Dfc"))
df_Clim_PFT_level_new$PFT<-substr(df_Clim_PFT_level_new$Clim.PFTs,5,7)
df_Clim_PFT_level_new$PFT<-factor(df_Clim_PFT_level_new$PFT,levels = c("DBF","MF","ENF"))
#
t_pos<-match(Env_var,names(df_Clim_PFT_level_new))
names(df_Clim_PFT_level_new)[t_pos]<-"Env_var"
#III.PFT level---
df_PFT_level<-df_site_level %>%
group_by(PFT)%>%
summarise(tmin=mean(tmin,na.rm=T),
tmean=mean(tmean,na.rm=T))
par_PFT_level<-df_paras[df_paras$flag=="PFT",] %>%
mutate(sitename=NULL,Clim_PFTs=NULL,flag=NULL)%>%
filter(parameter==para)
par_PFT_level<-par_PFT_level[,-1]
names(par_PFT_level)<-c("para","PFT")
#
df_PFT_level_new<-left_join(df_PFT_level,par_PFT_level)
#
t_pos<-match(Env_var,names(df_PFT_level_new))
names(df_PFT_level_new)[t_pos]<-"Env_var"
##----plotting----##
pars_final<-ggplot()+
geom_point(data=df_site_level_new,aes(x=Env_var,y=para,shape=PFT,size="site"))+
ggforce::geom_mark_ellipse(data=df_site_level_new,
aes(x=Env_var,y=para,label=PFT,shape=PFT),label.fill = "grey",
con.border = "one",con.cap = 0,con.size = 1.1,
con.arrow = grid::arrow(angle=30,ends = "last",length = unit(0.1,"inches")))+  ##site-level
geom_point(data=df_Clim_PFT_level_new,
aes(x=Env_var,y=para,shape=PFT,col=Clim,size="Clim-PFT"),alpha=0.8)+ ##Clim-PFT level
geom_point(data=df_PFT_level_new,
aes(x=Env_var,y=para,shape=PFT,size="PFT"),col="blue",alpha=0.4)+##PFT level
scale_size_manual("",values = c("site"=5,"Clim-PFT"=8,"PFT"=15))+
xlab(paste0(Env_var," (°C)"))+
ylab(paste0(para," (°C)"))+
theme(
legend.text = element_text(size=22),
legend.key.size = unit(2, 'lines'),
axis.title = element_text(size=26),
axis.text = element_text(size = 22),
text = element_text(size=24),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_rect(colour ="grey",fill="white")
)
if(do_legend==FALSE){
pars_final<-pars_final+
theme(legend.position = "none")
}
#
return(pars_final)
}
p_tmin_a1<-plot_paras(df_meteo = df_final_new,df_paras = data_sel_final,Env_var = "tmin",
para = "a1",FALSE)
p_tmean_b1<-plot_paras(df_meteo = df_final_new,df_paras = data_sel_final,Env_var = "tmean",
para = "b1",FALSE)
p_tmin_a2<-plot_paras(df_meteo = df_final_new,df_paras = data_sel_final,Env_var = "tmin",
para = "a2",FALSE)
p_tmean_b2<-plot_paras(df_meteo = df_final_new,df_paras = data_sel_final,Env_var = "tmean",
para = "b2",FALSE)
p_tmean_k<-plot_paras(df_meteo = df_final_new,df_paras = data_sel_final,Env_var = "tmean",
para = "k",TRUE)
#change the x labels:
p_tmin_a1<-p_tmin_a1+xlab(expression("T"[min]*" (°C)"))
p_tmean_b1<-p_tmean_b1+xlab(expression("T"[mean]*" (°C)"))
p_tmin_a2<-p_tmin_a2+xlab(expression("T"[min]*" (°C)"))
p_tmean_b2<-p_tmean_b2+xlab(expression("T"[mean]*" (°C)"))
p_tmean_k<-p_tmean_k+xlab(expression("T"[mean]*" (°C)"))+
theme(legend.position = c(1.7,0.4),
legend.spacing.y = unit(0.4, 'cm'),
legend.key.size = unit(2,"cm"))+
guides(size=guide_legend(ncol=3,byrow=T))+
guides(col=guide_legend(ncol = 4,byrow = T,override.aes = list(size = 6)))+
guides(shape=guide_legend(ncol = 3,byrow = T,override.aes = list(size = 6)))
#merge the plots:
paras_range<-cowplot::plot_grid(p_tmin_a1,p_tmean_b1,p_tmin_a2,p_tmean_b2,p_tmean_k,
nrow = 3,ncol=2,labels = "auto",label_size = 20,align = "hv")
######save the plot###########
save.path<-"./manuscript/figures/"
ggsave(paste0(save.path,"Figure7_parameters_ranges.png"),paras_range,height = 18,width = 20)
