group_by(classid, doy) %>%
dplyr::summarise(obs = mean(gpp_obs, na.rm = TRUE),
mod_old_ori=mean(gpp_mod_old_ori, na.rm = TRUE),
mod_recent_ori=mean(gpp_mod_recent_ori, na.rm = TRUE),
mod_recent_Beni=mean(gpp_mod_recent_Beni,na.rm = TRUE),
mod_recent_Mekela=mean(gpp_mod_recent_Mekela,na.rm = TRUE)) %>%
pivot_longer(c(obs,mod_old_ori,mod_recent_Beni,mod_recent_Mekela), names_to = "Source", values_to = "gpp") %>%
ggplot(aes(doy, gpp, color = Source)) +
geom_line() +
scale_color_manual("GPP sources",values = c("mod_old_ori" = "tomato",
"mod_recent_Beni" = "steelblue2",
"mod_recent_Mekela" = "orange",
"obs" = "gray4"),
labels = c("Orig. P-model", "Cali. P-model(Beni)","Cali. P-model(Beni)","Observations")) +
labs(y = expression( paste("GPP (g C m"^-2, " d"^-1, ")" ) ),
x = "DoY")
df_modobs %>%
mutate(doy = lubridate::yday(date)) %>%
group_by(classid, doy) %>%
dplyr::summarise(obs = mean(gpp_obs, na.rm = TRUE),
mod_old_ori=mean(gpp_mod_old_ori, na.rm = TRUE),
mod_recent_ori=mean(gpp_mod_recent_ori, na.rm = TRUE),
mod_recent_Beni=mean(gpp_mod_recent_Beni,na.rm = TRUE),
mod_recent_Mekela=mean(gpp_mod_recent_Mekela,na.rm = TRUE)) %>%
pivot_longer(c(obs,mod_old_ori,mod_recent_Beni,mod_recent_Mekela), names_to = "Source", values_to = "gpp") %>%
ggplot(aes(doy, gpp, color = Source)) +
geom_line() +
scale_color_manual("GPP sources",values = c("mod_old_ori" = "tomato",
"mod_recent_Beni" = "steelblue2",
"mod_recent_Mekela" = "orange",
"obs" = "gray4"),
labels = c("Orig. P-model", "Cali. P-model(Beni)","Cali. P-model(Beni)","Observations")) +
labs(y = expression( paste("GPP (g C m"^-2, " d"^-1, ")" ) ),
x = "DoY") +
# annotate(geom="text",x=200,y=2,label="")+
facet_wrap(~classid)+
theme(
legend.text = element_text(size=20),
legend.key.size = unit(2, 'lines'),
axis.title = element_text(size=24),
axis.text = element_text(size = 20),
text = element_text(size=24),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_rect(colour ="grey",fill="white"),
legend.position = "bottom"
)
#
season_plot<-df_modobs %>%
mutate(doy = lubridate::yday(date)) %>%
group_by(classid, doy) %>%
dplyr::summarise(obs = mean(gpp_obs, na.rm = TRUE),
mod_old_ori=mean(gpp_mod_old_ori, na.rm = TRUE),
mod_recent_ori=mean(gpp_mod_recent_ori, na.rm = TRUE),
mod_recent_Beni=mean(gpp_mod_recent_Beni,na.rm = TRUE),
mod_recent_Mekela=mean(gpp_mod_recent_Mekela,na.rm = TRUE)) %>%
pivot_longer(c(obs,mod_old_ori,mod_recent_Beni,mod_recent_Mekela), names_to = "Source", values_to = "gpp") %>%
ggplot(aes(doy, gpp, color = Source)) +
geom_line() +
scale_color_manual("GPP sources",values = c("mod_old_ori" = "tomato",
"mod_recent_Beni" = "steelblue2",
"mod_recent_Mekela" = "orange",
"obs" = "gray4"),
labels = c("Orig. P-model", "Cali. P-model(Beni)","Cali. P-model(Beni)","Observations")) +
labs(y = expression( paste("GPP (g C m"^-2, " d"^-1, ")" ) ),
x = "DoY") +
# annotate(geom="text",x=200,y=2,label="")+
facet_wrap(~classid)+
theme(
legend.text = element_text(size=20),
legend.key.size = unit(2, 'lines'),
axis.title = element_text(size=24),
axis.text = element_text(size = 20),
text = element_text(size=24),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_rect(colour ="grey",fill="white"),
legend.position = "bottom"
)
#print the plot
tag_facet <- function(p, open = "", close = "", tag_pool = letters, x = -Inf, y = Inf,
hjust = -0.5, vjust = 1.5, fontface = 2, family = "", ...) {
gb <- ggplot_build(p)
lay <- gb$layout$layout
tags <- cbind(lay, label = paste0(open, tag_pool[lay$PANEL], close), x = x, y = y)
p + geom_text(data = tags, aes_string(x = "x", y = "y", label = "label"), ..., hjust = hjust,
vjust = vjust, fontface = fontface, family = family, inherit.aes = FALSE)
}
library(egg)
season_plot_new<-tag_facet(season_plot,x=sites_num.info$doy,y=sites_num.info$gpp,
tag_pool = sites_num.info$label,size=5)
# annotate(geom = "text",x=sites_num.info$x,
#          y=sites_num.info$y,label=sites_num.info$label)
#save the plot
save.path<-"./manuscript/test_files/comp_diff_parameterization_performance/"
ggsave(paste0(save.path,"pmodel_vs_obs_forPFTs.png"),season_plot,width = 15,height = 10)
#b. Seasonal course for each sites in different PFTs:
# For DBF:
df_modobs %>%
filter(classid=="DBF") %>%
mutate(doy = lubridate::yday(date)) %>%
group_by(sitename, doy) %>%
dplyr::summarise(obs = mean(gpp_obs, na.rm = TRUE),
mod_old_ori=mean(gpp_mod_old_ori, na.rm = TRUE),
mod_recent_ori=mean(gpp_mod_recent_ori, na.rm = TRUE),
mod_recent_Beni=mean(gpp_mod_recent_Beni,na.rm = TRUE),
mod_recent_Mekela=mean(gpp_mod_recent_Mekela,na.rm = TRUE)) %>%
pivot_longer(c(obs,mod_old_ori,mod_recent_ori,mod_recent_Beni,mod_recent_Mekela), names_to = "Source", values_to = "gpp") %>%
ggplot(aes(doy, gpp, color = Source)) +
geom_line() +
scale_color_manual(values = c("mod_old_ori" = "red","mod_recent_ori"="dodgerblue","mod_recent_Beni" = "sienna",
"mod_recent_Mekela" = "orange","obs" = "black"),
labels = c("Old P-model","Recent Ori P-model",
"Recent Optim P-model Beni","Recent Optim P-model Mekela","Obs.")) +
labs(y = expression( paste("GPP (g C m"^-2, " d"^-1, ")" ) ),
x = "Day of year") +
facet_wrap(~sitename)+
theme_bw()
# - for MF
df_modobs %>%
filter(classid=="MF") %>%
mutate(doy = lubridate::yday(date)) %>%
group_by(sitename, doy) %>%
dplyr::summarise(obs = mean(gpp_obs, na.rm = TRUE),
mod_old_ori=mean(gpp_mod_old_ori, na.rm = TRUE),
mod_recent_ori=mean(gpp_mod_recent_ori, na.rm = TRUE),
mod_recent_Beni=mean(gpp_mod_recent_Beni,na.rm = TRUE),
mod_recent_Mekela=mean(gpp_mod_recent_Mekela,na.rm = TRUE)) %>%
pivot_longer(c(obs,mod_old_ori,mod_recent_ori,mod_recent_Beni,mod_recent_Mekela), names_to = "Source", values_to = "gpp") %>%
ggplot(aes(doy, gpp, color = Source)) +
geom_line() +
scale_color_manual(values = c("mod_old_ori" = "red","mod_recent_ori"="dodgerblue","mod_recent_Beni" = "sienna",
"mod_recent_Mekela" = "orange","obs" = "black"),
labels = c("Old P-model","Recent Ori P-model",
"Recent Optim P-model Beni","Recent Optim P-model Mekela","Obs.")) +
labs(y = expression( paste("GPP (g C m"^-2, " d"^-1, ")" ) ),
x = "Day of year") +
facet_wrap(~sitename)+
theme_bw()
# - for ENF
df_modobs %>%
filter(classid=="ENF") %>%
mutate(doy = lubridate::yday(date)) %>%
group_by(sitename, doy) %>%
dplyr::summarise(obs = mean(gpp_obs, na.rm = TRUE),
mod_old_ori=mean(gpp_mod_old_ori, na.rm = TRUE),
mod_recent_ori=mean(gpp_mod_recent_ori, na.rm = TRUE),
mod_recent_Beni=mean(gpp_mod_recent_Beni,na.rm = TRUE),
mod_recent_Mekela=mean(gpp_mod_recent_Mekela,na.rm = TRUE)) %>%
pivot_longer(c(obs,mod_old_ori,mod_recent_ori,mod_recent_Beni,mod_recent_Mekela), names_to = "Source", values_to = "gpp") %>%
ggplot(aes(doy, gpp, color = Source)) +
geom_line() +
scale_color_manual(values = c("mod_old_ori" = "red","mod_recent_ori"="dodgerblue","mod_recent_Beni" = "sienna",
"mod_recent_Mekela" = "orange","obs" = "black"),
labels = c("Old P-model","Recent Ori P-model",
"Recent Optim P-model Beni","Recent Optim P-model Mekela","Obs.")) +
labs(y = expression( paste("GPP (g C m"^-2, " d"^-1, ")" ) ),
x = "Day of year") +
facet_wrap(~sitename)+
theme_bw()
#------------------------------------------
#Additional plots(2022-06):compare the modelled GPP with optimilized 3 pars(for diff PFTs)
#with observed GPP-->for different Clim-PFTs
#------------------------------------------
#a.get the stress factor(calibration factor) for each Clim-PFT:using the same parameters
#for each
#
test<-df_merge_new %>%
select(sitename,date,doy,classid,Clim_PFTs,gpp_obs_recent,gpp_mod_FULL_ori,
gpp_mod_recent_ori,gpp_mod_recent_Beni,gpp_mod_recent_Mekela) %>%
mutate(gpp_obs=gpp_obs_recent,
gpp_mod_old_ori=gpp_mod_FULL_ori,
gpp_mod_recent_ori=gpp_mod_recent_ori,
gpp_mod_recent_Beni=gpp_mod_recent_Beni,
gpp_mod_recent_Mekela=gpp_mod_recent_Mekela,
) %>%
mutate(gpp_obs_recent=NULL,
gpp_mod_FULL_ori=NULL)
#for Clim-PFTs
season_plot<-test %>%
group_by(Clim_PFTs, doy) %>%
dplyr::summarise(obs = mean(gpp_obs, na.rm = TRUE),
mod_old_ori=mean(gpp_mod_old_ori, na.rm = TRUE),
mod_recent_ori=mean(gpp_mod_recent_ori, na.rm = TRUE),
mod_recent_Beni=mean(gpp_mod_recent_Beni,na.rm = TRUE),
mod_recent_Mekela=mean(gpp_mod_recent_Mekela,na.rm = TRUE)
) %>%
pivot_longer(c(obs,mod_old_ori,mod_recent_Beni,mod_recent_Mekela),
names_to = "Source", values_to = "gpp") %>%
ggplot(aes(doy, gpp, color = Source)) +
geom_line() +
scale_color_manual("GPP sources",values = c("mod_old_ori" = "tomato",
"mod_recent_Beni" = "dodgerblue","mod_recent_Mekela"="orange","obs" = "gray4"),
labels = c("Orig. P-model", "Cali. P-model(Beni)","Cali. P-model(Mekela)","Observations")) +
labs(y = expression( paste("GPP (g C m"^-2, " d"^-1, ")" ) ),
x = "DoY") +
# annotate(geom="text",x=200,y=2,label="")+
facet_wrap(~Clim_PFTs)+
theme(
legend.text = element_text(size=20),
legend.key.size = unit(2, 'lines'),
axis.title = element_text(size=24),
axis.text = element_text(size = 20),
text = element_text(size=24),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_rect(colour ="grey",fill="white"),
legend.position = "bottom"
)
##adding the site numbers in each category:
nsites<-test %>%
group_by(Clim_PFTs)%>%
dplyr::summarise(nsite=length(unique(sitename)))
nsites$label<-paste0("N = ",nsites$nsite)
sites_num.info<-data.frame(
doy=rep(20,nrow(nsites)),
gpp=rep(14,nrow(nsites)),
nsites
)
season_plot_new<-tag_facet(season_plot,x=sites_num.info$doy,y=sites_num.info$gpp,
tag_pool = sites_num.info$label,size=5)
#save the plot
save.path<-"./manuscript/test_files/comp_diff_parameterization_performance/"
ggsave(paste0(save.path,"pmodel_vs_obs_forClimPFTs_3set_parameter.png"),
season_plot_new,width = 15,height = 10)
#for different sites in Cfb-MF(the sites where GPP is not improved)
test %>%
filter(Clim_PFTs=="Cfb-MF")%>%
group_by(sitename, doy) %>%
dplyr::summarise(obs = mean(gpp_obs, na.rm = TRUE),
mod_old_ori=mean(gpp_mod_old_ori, na.rm = TRUE),
mod_recent_ori=mean(gpp_mod_recent_ori, na.rm = TRUE),
mod_recent_Beni=mean(gpp_mod_recent_Beni,na.rm = TRUE),
mod_recent_Mekela=mean(gpp_mod_recent_Mekela,na.rm = TRUE)
) %>%
pivot_longer(c(obs,mod_old_ori,mod_recent_Beni,mod_recent_Mekela),
names_to = "Source", values_to = "gpp") %>%
ggplot(aes(doy, gpp, color = Source)) +
geom_line() +
scale_color_manual("GPP sources",values = c("mod_old_ori" = "tomato",
"mod_recent_Beni" = "dodgerblue","mod_recent_Mekela"="orange","obs" = "gray4"),
labels = c("Orig. P-model", "Cali. P-model(Beni)","Cali. P-model(Mekela)","Observations"))+
labs(y = expression( paste("GPP (g C m"^-2, " d"^-1, ")" ) ),
x = "DoY") +
# annotate(geom="text",x=200,y=2,label="")+
facet_wrap(~sitename)+
theme(
legend.text = element_text(size=20),
legend.key.size = unit(2, 'lines'),
axis.title = element_text(size=24),
axis.text = element_text(size = 20),
text = element_text(size=24),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_rect(colour ="grey",fill="white"),
legend.position = "bottom"
)
#---------------------------------------
#(6) stats summary
#---------------------------------------
library(sirad)
stats_summary<-function(df,sel_vars){
# df<-test
# sel_vars<-c("gpp_mod_recent_Beni")
df.new<-df %>%
select(sitename,classid,doy,Clim_PFTs,sel_vars,gpp_obs)
names(df.new)<-c("sitename","PFT","doy","Clim.PFTs","mod","obs")
stat.PFTs<-df.new %>%
group_by(PFT)%>%
summarise(N=as.numeric(modeval(mod,obs,stat = "N")),
MBE=as.numeric(modeval(mod,obs,stat = "MBE")),
MAE=as.numeric(modeval(mod,obs,stat = "MAE")),
RMSE=as.numeric(modeval(mod,obs,stat = "RMSE")),
R2=as.numeric(modeval(mod,obs,stat = "R2")),
EF=as.numeric(modeval(mod,obs,stat = "EF")))
stat.PFTs_spring<-df.new %>%
filter(doy>=60 & doy<=121)%>%
group_by(PFT)%>%
summarise(N=as.numeric(modeval(mod,obs,stat = "N")),
MBE=as.numeric(modeval(mod,obs,stat = "MBE")),
MAE=as.numeric(modeval(mod,obs,stat = "MAE")),
RMSE=as.numeric(modeval(mod,obs,stat = "RMSE")),
R2=as.numeric(modeval(mod,obs,stat = "R2")),
EF=as.numeric(modeval(mod,obs,stat = "EF")))
##
stat.Clim.PFTs<-df.new %>%
group_by(Clim.PFTs)%>%
summarise(N=as.numeric(modeval(mod,obs,stat = "N")),
MBE=as.numeric(modeval(mod,obs,stat = "MBE")),
MAE=as.numeric(modeval(mod,obs,stat = "MAE")),
RMSE=as.numeric(modeval(mod,obs,stat = "RMSE")),
R2=as.numeric(modeval(mod,obs,stat = "R2")),
EF=as.numeric(modeval(mod,obs,stat = "EF")))
stat.Clim.PFTs_spring<-df.new %>%
filter(doy>=60 & doy<=121)%>%
group_by(Clim.PFTs)%>%
summarise(N=as.numeric(modeval(mod,obs,stat = "N")),
MBE=as.numeric(modeval(mod,obs,stat = "MBE")),
MAE=as.numeric(modeval(mod,obs,stat = "MAE")),
RMSE=as.numeric(modeval(mod,obs,stat = "RMSE")),
R2=as.numeric(modeval(mod,obs,stat = "R2")),
EF=as.numeric(modeval(mod,obs,stat = "EF")))
stats_sum<-list(stat.PFTs=stat.PFTs,stat.PFTs_spring=stat.PFTs_spring,
stat.Clim.PFTs=stat.Clim.PFTs,stat.Clim.PFTs_spring=stat.Clim.PFTs_spring)
return(stats_sum)
}
#stats for Beni's method:
stats_Beni<-stats_summary(test,c("gpp_mod_recent_Beni"))
stats_Mekela<-stats_summary(test,c("gpp_mod_recent_Mekela"))
#
season_plot<-df_modobs %>%
mutate(doy = lubridate::yday(date)) %>%
group_by(classid, doy) %>%
dplyr::summarise(obs = mean(gpp_obs, na.rm = TRUE),
mod_old_ori=mean(gpp_mod_old_ori, na.rm = TRUE),
mod_recent_ori=mean(gpp_mod_recent_ori, na.rm = TRUE),
mod_recent_Beni=mean(gpp_mod_recent_Beni,na.rm = TRUE),
mod_recent_Mekela=mean(gpp_mod_recent_Mekela,na.rm = TRUE)) %>%
pivot_longer(c(obs,mod_old_ori,mod_recent_Beni,mod_recent_Mekela), names_to = "Source", values_to = "gpp") %>%
ggplot(aes(doy, gpp, color = Source)) +
geom_line() +
scale_color_manual("GPP sources",values = c("mod_old_ori" = "tomato",
"mod_recent_Beni" = "steelblue2",
"mod_recent_Mekela" = "orange",
"obs" = "gray4"),
labels = c("Orig. P-model", "Cali. P-model(Beni)","Cali. P-model(Mekela)","Observations")) +
labs(y = expression( paste("GPP (g C m"^-2, " d"^-1, ")" ) ),
x = "DoY") +
# annotate(geom="text",x=200,y=2,label="")+
facet_wrap(~classid)+
theme(
legend.text = element_text(size=20),
legend.key.size = unit(2, 'lines'),
axis.title = element_text(size=24),
axis.text = element_text(size = 20),
text = element_text(size=24),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_rect(colour ="grey",fill="white"),
legend.position = "bottom"
)
#print the plot
tag_facet <- function(p, open = "", close = "", tag_pool = letters, x = -Inf, y = Inf,
hjust = -0.5, vjust = 1.5, fontface = 2, family = "", ...) {
gb <- ggplot_build(p)
lay <- gb$layout$layout
tags <- cbind(lay, label = paste0(open, tag_pool[lay$PANEL], close), x = x, y = y)
p + geom_text(data = tags, aes_string(x = "x", y = "y", label = "label"), ..., hjust = hjust,
vjust = vjust, fontface = fontface, family = family, inherit.aes = FALSE)
}
library(egg)
season_plot_new<-tag_facet(season_plot,x=sites_num.info$doy,y=sites_num.info$gpp,
tag_pool = sites_num.info$label,size=5)
# annotate(geom = "text",x=sites_num.info$x,
#          y=sites_num.info$y,label=sites_num.info$label)
#save the plot
save.path<-"./manuscript/test_files/comp_diff_parameterization_performance/"
#--------------------------
#modelled and observed gpp:scatter plots-->errors occur, need to find out the reasons later (2022-May,04)
#-------------------------
#source the function:analyse_modobs2
# source(file = "./R/functions_from_beni/analyse_modobs2.R")
plot_modobs_general<-c()
df_modobs<-c()
for(i in 1:length(PFTs)){
#
df_modobs_each<-df_merge_new %>%
filter(classid==PFTs[i]) %>%
select(sitename,date,classid,gpp_obs_recent,gpp_mod_FULL_ori,gpp_mod_recent_ori,
gpp_mod_recent_Beni,gpp_mod_recent_Mekela) %>%
mutate(gpp_obs=gpp_obs_recent,
gpp_mod_old_ori=gpp_mod_FULL_ori,
gpp_mod_recent_ori=gpp_mod_recent_ori,
gpp_mod_recent_Beni=gpp_mod_recent_Beni,
gpp_mod_recent_Mekela=gpp_mod_recent_Mekela
) %>%
mutate(gpp_obs_recent=NULL,
gpp_mod_FULL_ori=NULL)
#
df_modobs<-rbind(df_modobs,df_modobs_each)
#some setting-->only compare when both gpp_obs and gpp_mod_old_ori are available:
# df_modobs_each<-df_modobs_each[!is.nan(df_modobs_each$gpp_mod_old_ori) & !is.nan(df_modobs_each$gpp_obs),]
# #scatter plots to compare the model and observation gpp
# gpp_modobs_comp1<-df_modobs_each %>%
#   analyse_modobs2("gpp_mod_old_ori", "gpp_obs", type = "heat")
# # gpp_modobs_comp2<-df_modobs_each %>%
# #   analyse_modobs2("gpp_mod_recent_ori", "gpp_obs", type = "heat")
# gpp_modobs_comp3<-df_modobs_each %>%
#   analyse_modobs2("gpp_mod_recent_optim", "gpp_obs", type = "heat")
# # add the site-name:
# gpp_modobs_comp1$gg<-gpp_modobs_comp1$gg+
#   annotate(geom="text",x=15,y=0,label=PFTs[i])
# gpp_modobs_comp2$gg<-gpp_modobs_comp2$gg+
#   annotate(geom="text",x=15,y=0,label=PFTs[i])
# gpp_modobs_comp3$gg<-gpp_modobs_comp3$gg+
#   annotate(geom="text",x=15,y=0,label=PFTs[i])
#
# #merge two plots
# if(PFTs[i]=="ENF"){
#   p1<-gpp_modobs_comp1$gg+
#     ylab(expression("GPP"[EC]*" (g C m"^-2*" d"^-1*")"))+
#     xlab(expression("GPP"[Orig.P-model]*" (g C m"^-2*" d"^-1*")"))+
#     annotate(geom="text",x=0,y=20,label="e")
#
#   p3<-gpp_modobs_comp3$gg+
#     ylab("")+
#     xlab(expression("GPP"[Cali.P-model]*" (g C m"^-2*" d"^-1*")"))+
#     annotate(geom="text",x=0,y=20,label="f")
# }
# if(PFTs[i]=="DBF"){
#   p1<-gpp_modobs_comp1$gg+
#     ylab(expression("GPP"[EC]*" (g C m"^-2*" d"^-1*")"))+
#     xlab("")+
#     annotate(geom="text",x=0,y=20,label="a")
#
#   p3<-gpp_modobs_comp3$gg+
#     ylab("")+
#     xlab("")+
#     annotate(geom="text",x=0,y=20,label="b")
# }
# if(PFTs[i]=="MF"){
#   p1<-gpp_modobs_comp1$gg+
#     ylab(expression("GPP"[EC]*" (g C m"^-2*" d"^-1*")"))+
#     xlab("")+
#     annotate(geom="text",x=0,y=20,label="c")
#
#   p3<-gpp_modobs_comp3$gg+
#     ylab("")+
#     xlab("")+
#     annotate(geom="text",x=0,y=20,label="d")
# }
#
# evaulation_merge_plot<-plot_grid(p1,p3,
#                                  widths=15,heights=4,
#                                  ncol =2,nrow = 1,label_size = 12,align = "hv")
# # plot(evaulation_merge_plot)
#
# #put all the plots together:
# plot_modobs_general[[i]]<-evaulation_merge_plot
}
#update using original p-model
##
nsites<-df_modobs %>%
group_by(classid)%>%
dplyr::summarise(nsite=length(unique(sitename)))
nsites$label<-paste0("N = ",nsites$nsite)
sites_num.info<-data.frame(
doy=rep(20,nrow(nsites)),
gpp=rep(14,nrow(nsites)),
nsites
)
#
season_plot<-df_modobs %>%
mutate(doy = lubridate::yday(date)) %>%
group_by(classid, doy) %>%
dplyr::summarise(obs = mean(gpp_obs, na.rm = TRUE),
mod_old_ori=mean(gpp_mod_old_ori, na.rm = TRUE),
mod_recent_ori=mean(gpp_mod_recent_ori, na.rm = TRUE),
mod_recent_Beni=mean(gpp_mod_recent_Beni,na.rm = TRUE),
mod_recent_Mekela=mean(gpp_mod_recent_Mekela,na.rm = TRUE)) %>%
pivot_longer(c(obs,mod_old_ori,mod_recent_Beni,mod_recent_Mekela), names_to = "Source", values_to = "gpp") %>%
ggplot(aes(doy, gpp, color = Source)) +
geom_line() +
scale_color_manual("GPP sources",values = c("mod_old_ori" = "tomato",
"mod_recent_Beni" = "steelblue2",
"mod_recent_Mekela" = "orange",
"obs" = "gray4"),
labels = c("Orig. P-model", "Cali. P-model(Beni)","Cali. P-model(Mekela)","Observations")) +
labs(y = expression( paste("GPP (g C m"^-2, " d"^-1, ")" ) ),
x = "DoY") +
# annotate(geom="text",x=200,y=2,label="")+
facet_wrap(~classid)+
theme(
legend.text = element_text(size=20),
legend.key.size = unit(2, 'lines'),
axis.title = element_text(size=24),
axis.text = element_text(size = 20),
text = element_text(size=24),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_rect(colour ="grey",fill="white"),
legend.position = "bottom"
)
#print the plot
tag_facet <- function(p, open = "", close = "", tag_pool = letters, x = -Inf, y = Inf,
hjust = -0.5, vjust = 1.5, fontface = 2, family = "", ...) {
gb <- ggplot_build(p)
lay <- gb$layout$layout
tags <- cbind(lay, label = paste0(open, tag_pool[lay$PANEL], close), x = x, y = y)
p + geom_text(data = tags, aes_string(x = "x", y = "y", label = "label"), ..., hjust = hjust,
vjust = vjust, fontface = fontface, family = family, inherit.aes = FALSE)
}
library(egg)
season_plot_new<-tag_facet(season_plot,x=sites_num.info$doy,y=sites_num.info$gpp,
tag_pool = sites_num.info$label,size=5)
# annotate(geom = "text",x=sites_num.info$x,
#          y=sites_num.info$y,label=sites_num.info$label)
#save the plot
save.path<-"./manuscript/test_files/comp_diff_parameterization_performance/"
ggsave(paste0(save.path,"pmodel_vs_obs_forPFTs.png"),season_plot,width = 15,height = 10)
stats_Beni
stats_Beni$stat.PFTs
stats_Mekela$stat.PFTs
stats_Mekela$stat.Clim.PFTs
stats_Beni$stat.Clim.PFTs
stats_Beni$stat.PFTs_spring
stats_Beni$stat.Clim.PFTs
stats_Mekela$stat.PFTs_spring
stats_Mekela$stat.Clim.PFTs_spring
stats_Beni$stat.Clim.PFTs_spring
source('D:/Github/photocold_manuscript/test/comp_diff_parameterization_performance/compare_diff_parameterization_performance_PFT.R')
stats_Beni$stat.Clim.PFTs_spring
