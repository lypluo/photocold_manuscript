ggplot(aes(x=doy,y=GCC))+
geom_point()+
facet_grid(~sitename)
df<-df.VI_new
PFT_name<-"DBF"
VI_source<-"PhenoCam"
#
df.proc<-df %>%
dplyr::select(sitename,date,EVI,NDVI,NIRv,kNDVI,
gcc_90,rcc_90,GRVI,flag,year,month,doy,PFT)%>%
filter(PFT==PFT_name)
#test
df.proc %>%
group_by(sitename,doy)%>%
dplyr::summarise(doy=mean(doy),GCC=mean(gcc_90,na.rm=T),
RCC=mean(rcc_90,na.rm=T),
GRVI=mean(GRVI,na.rm=T))%>%
ggplot(aes(x=doy,y=GCC))+
geom_point()+
facet_grid(~sitename)
#For PhenoCam VIs, in order to compare among sites, first to do the following steps:
#for each sites using the 1) smooth(mean) the data according to doy:
#2)VIs -VImin(smooth)-->(3)then normalize the VIs by ampl=VImax-VImin:
Cam.VIs_stats_temp<-df.proc %>%
group_by(sitename,doy)%>%
dplyr::summarise(doy=mean(doy),gcc=mean(gcc_90,na.rm=T),
rcc=mean(rcc_90,na.rm=T),
GRVI=mean(GRVI,na.rm=T))
Cam.VIs_stats<-Cam.VIs_stats_temp %>%
dplyr::summarise(gcc_mn=min(gcc,na.rm = T),gcc_q10=quantile(gcc,probs=0.1,na.rm=T),gcc_mm=max(gcc,na.rm = T),
rcc_mn=min(rcc,na.rm = T),rcc_q10=quantile(rcc,probs=0.1,na.rm=T),rcc_mm=max(rcc,na.rm = T),
GRVI_mn=min(GRVI,na.rm = T),GRVI_q10=quantile(GRVI,probs=0.1,na.rm=T),GRVI_mm=max(GRVI,na.rm = T),
)%>%
mutate(gcc_ampl=gcc_mm - gcc_q10,
rcc_ampl=rcc_mm - rcc_q10,
GRVI_ampl=GRVI_mm - GRVI_q10)
#adjust the original PhenoCam VIs:
df.proc_new<-left_join(df.proc,Cam.VIs_stats,by="sitename")
df.results<-df.proc_new %>%
mutate(gcc_adj= c(gcc_90 - gcc_q10)/gcc_ampl,
rcc_adj= c(rcc_90 - rcc_q10)/rcc_ampl,
GRVI_adj= c(GRVI - GRVI_q10)/GRVI_ampl)
#################
df.results$doy<-yday(df.results$date)
df.results %>%
group_by(sitename,doy)%>%
dplyr::summarise(doy=mean(doy),GCC=mean(gcc_adj,na.rm=T),
RCC=mean(rcc_adj,na.rm=T),
GRVI=mean(GRVI_adj,na.rm=T))%>%
ggplot(aes(x=doy,y=GCC))+
geom_point()+
facet_grid(~sitename)
df_summary<-df.results %>%
group_by(flag,doy)%>%
# filter(month<=6)%>%
dplyr::summarise(doy=mean(doy),GCC=mean(gcc_adj,na.rm=T),
RCC=mean(rcc_adj,na.rm=T),
GRVI=mean(GRVI_adj,na.rm=T),
NDVI=mean(NDVI,na.rm=T),
EVI=mean(EVI,na.rm=T),
NIRv=mean(NIRv,na.rm=T),
kNDVI=mean(kNDVI,na.rm=T)
)%>%
pivot_longer(c(GCC,RCC,GRVI,NDVI,EVI,NIRv,kNDVI),names_to = "Source",values_to = "VIs")
df_summary %>%
filter(Source %in% c("GCC","RCC","GRVI"))%>%
# ggplot(aes(x=doy,y=GCC,col=flag))+
# ggplot(aes(x=doy,y=RCC,col=flag))+
# ggplot(aes(x=doy,y=GRVI,col=flag))+
ggplot(aes(x=doy,y=VIs,col=flag))+
geom_point()+
annotate("rect",xmin=69,xmax=147,ymin = -Inf,ymax = Inf,alpha=0.2)+
scale_color_manual("",values = c("noTa_stress"="green4","Ta_stress"="tomato"),
labels=c("Less Ta stress","Higher Ta stress"))+
xlab("DoY (day)")+ylab("Normalized PhenoCam VIs")+
facet_grid(~Source)+
theme_classic()+
theme(legend.text = element_text(size=20),
axis.title = element_text(size=24),
axis.text = element_text(size = 20),
text = element_text(size=24))+
annotate(geom = "text",x=200,y=-0.1,label=PFT_name,col="blue",size=8)
df_summary %>%
filter(Source %in% c("NDVI","EVI","NIRv"))%>%
ggplot(aes(x=doy,y=VIs,col=flag))+
geom_point()+
annotate("rect",xmin=69,xmax=147,ymin = -Inf,ymax = Inf,alpha=0.2)+
scale_color_manual("",values = c("noTa_stress"="green4","Ta_stress"="tomato"),
labels=c("Less Ta stress","Higher Ta stress"))+
xlab("DoY (day)")+ylab("Normalized MODIS VIs")+
facet_grid(~Source)+
theme_classic()+
theme(legend.text = element_text(size=20),
axis.title = element_text(size=24),
axis.text = element_text(size = 20),
text = element_text(size=24))+
annotate(geom = "text",x=200,y=-0.1,label=PFT_name,col="blue",size=8)
df<-df.VI_new
PFT_name<-"ENF"
VI_source<-"PhenoCam"
#
df.proc<-df %>%
dplyr::select(sitename,date,EVI,NDVI,NIRv,kNDVI,
gcc_90,rcc_90,GRVI,flag,year,month,doy,PFT)%>%
filter(PFT==PFT_name)
#test
df.proc %>%
group_by(sitename,doy)%>%
dplyr::summarise(doy=mean(doy),GCC=mean(gcc_90,na.rm=T),
RCC=mean(rcc_90,na.rm=T),
GRVI=mean(GRVI,na.rm=T))%>%
ggplot(aes(x=doy,y=GCC))+
geom_point()+
facet_grid(~sitename)
#For PhenoCam VIs, in order to compare among sites, first to do the following steps:
#for each sites using the 1) smooth(mean) the data according to doy:
#2)VIs -VImin(smooth)-->(3)then normalize the VIs by ampl=VImax-VImin:
Cam.VIs_stats_temp<-df.proc %>%
group_by(sitename,doy)%>%
dplyr::summarise(doy=mean(doy),gcc=mean(gcc_90,na.rm=T),
rcc=mean(rcc_90,na.rm=T),
GRVI=mean(GRVI,na.rm=T))
Cam.VIs_stats<-Cam.VIs_stats_temp %>%
dplyr::summarise(gcc_mn=min(gcc,na.rm = T),gcc_q10=quantile(gcc,probs=0.1,na.rm=T),gcc_mm=max(gcc,na.rm = T),
rcc_mn=min(rcc,na.rm = T),rcc_q10=quantile(rcc,probs=0.1,na.rm=T),rcc_mm=max(rcc,na.rm = T),
GRVI_mn=min(GRVI,na.rm = T),GRVI_q10=quantile(GRVI,probs=0.1,na.rm=T),GRVI_mm=max(GRVI,na.rm = T),
)%>%
mutate(gcc_ampl=gcc_mm - gcc_q10,
rcc_ampl=rcc_mm - rcc_q10,
GRVI_ampl=GRVI_mm - GRVI_q10)
#adjust the original PhenoCam VIs:
df.proc_new<-left_join(df.proc,Cam.VIs_stats,by="sitename")
df.results<-df.proc_new %>%
mutate(gcc_adj= c(gcc_90 - gcc_q10)/gcc_ampl,
rcc_adj= c(rcc_90 - rcc_q10)/rcc_ampl,
GRVI_adj= c(GRVI - GRVI_q10)/GRVI_ampl)
#################
df.results$doy<-yday(df.results$date)
df.results %>%
group_by(sitename,doy)%>%
dplyr::summarise(doy=mean(doy),GCC=mean(gcc_adj,na.rm=T),
RCC=mean(rcc_adj,na.rm=T),
GRVI=mean(GRVI_adj,na.rm=T))%>%
ggplot(aes(x=doy,y=GCC))+
geom_point()+
facet_grid(~sitename)
df_summary<-df.results %>%
group_by(flag,doy)%>%
# filter(month<=6)%>%
dplyr::summarise(doy=mean(doy),GCC=mean(gcc_adj,na.rm=T),
RCC=mean(rcc_adj,na.rm=T),
GRVI=mean(GRVI_adj,na.rm=T),
NDVI=mean(NDVI,na.rm=T),
EVI=mean(EVI,na.rm=T),
NIRv=mean(NIRv,na.rm=T),
kNDVI=mean(kNDVI,na.rm=T)
)%>%
pivot_longer(c(GCC,RCC,GRVI,NDVI,EVI,NIRv,kNDVI),names_to = "Source",values_to = "VIs")
df_summary %>%
filter(Source %in% c("GCC","RCC","GRVI"))%>%
# ggplot(aes(x=doy,y=GCC,col=flag))+
# ggplot(aes(x=doy,y=RCC,col=flag))+
# ggplot(aes(x=doy,y=GRVI,col=flag))+
ggplot(aes(x=doy,y=VIs,col=flag))+
geom_point()+
annotate("rect",xmin=69,xmax=147,ymin = -Inf,ymax = Inf,alpha=0.2)+
scale_color_manual("",values = c("noTa_stress"="green4","Ta_stress"="tomato"),
labels=c("Less Ta stress","Higher Ta stress"))+
xlab("DoY (day)")+ylab("Normalized PhenoCam VIs")+
facet_grid(~Source)+
theme_classic()+
theme(legend.text = element_text(size=20),
axis.title = element_text(size=24),
axis.text = element_text(size = 20),
text = element_text(size=24))+
annotate(geom = "text",x=200,y=-0.1,label=PFT_name,col="blue",size=8)
names(df.results)
df_summary<-df.results %>%
filter(sitename!="DE-Tha")
group_by(flag,doy)%>%
# filter(month<=6)%>%
dplyr::summarise(doy=mean(doy),GCC=mean(gcc_adj,na.rm=T),
RCC=mean(rcc_adj,na.rm=T),
GRVI=mean(GRVI_adj,na.rm=T),
NDVI=mean(NDVI,na.rm=T),
EVI=mean(EVI,na.rm=T),
NIRv=mean(NIRv,na.rm=T),
kNDVI=mean(kNDVI,na.rm=T)
)%>%
pivot_longer(c(GCC,RCC,GRVI,NDVI,EVI,NIRv,kNDVI),names_to = "Source",values_to = "VIs")
df_summary<-df.results %>%
filter(sitename!="DE-Tha")%>%
group_by(flag,doy)%>%
# filter(month<=6)%>%
dplyr::summarise(doy=mean(doy),GCC=mean(gcc_adj,na.rm=T),
RCC=mean(rcc_adj,na.rm=T),
GRVI=mean(GRVI_adj,na.rm=T),
NDVI=mean(NDVI,na.rm=T),
EVI=mean(EVI,na.rm=T),
NIRv=mean(NIRv,na.rm=T),
kNDVI=mean(kNDVI,na.rm=T)
)%>%
pivot_longer(c(GCC,RCC,GRVI,NDVI,EVI,NIRv,kNDVI),names_to = "Source",values_to = "VIs")
df_summary %>%
filter(Source %in% c("GCC","RCC","GRVI"))%>%
# ggplot(aes(x=doy,y=GCC,col=flag))+
# ggplot(aes(x=doy,y=RCC,col=flag))+
# ggplot(aes(x=doy,y=GRVI,col=flag))+
ggplot(aes(x=doy,y=VIs,col=flag))+
geom_point()+
annotate("rect",xmin=69,xmax=147,ymin = -Inf,ymax = Inf,alpha=0.2)+
scale_color_manual("",values = c("noTa_stress"="green4","Ta_stress"="tomato"),
labels=c("Less Ta stress","Higher Ta stress"))+
xlab("DoY (day)")+ylab("Normalized PhenoCam VIs")+
facet_grid(~Source)+
theme_classic()+
theme(legend.text = element_text(size=20),
axis.title = element_text(size=24),
axis.text = element_text(size = 20),
text = element_text(size=24))+
annotate(geom = "text",x=200,y=-0.1,label=PFT_name,col="blue",size=8)
df<-df.VI_new
PFT_name<-"ENF"
VI_source<-"PhenoCam"
#
df.proc<-df %>%
dplyr::select(sitename,date,EVI,NDVI,NIRv,kNDVI,
gcc_90,rcc_90,GRVI,flag,year,month,doy,PFT)%>%
filter(PFT==PFT_name)
#test
df.proc %>%
group_by(sitename,doy)%>%
dplyr::summarise(doy=mean(doy),GCC=mean(gcc_90,na.rm=T),
RCC=mean(rcc_90,na.rm=T),
GRVI=mean(GRVI,na.rm=T))%>%
ggplot(aes(x=doy,y=GCC))+
geom_point()+
facet_grid(~sitename)
#For PhenoCam VIs, in order to compare among sites, first to do the following steps:
#for each sites using the 1) smooth(mean) the data according to doy:
#2)VIs -VImin(smooth)-->(3)then normalize the VIs by ampl=VImax-VImin:
Cam.VIs_stats_temp<-df.proc %>%
group_by(sitename,doy)%>%
dplyr::summarise(doy=mean(doy),gcc=mean(gcc_90,na.rm=T),
rcc=mean(rcc_90,na.rm=T),
GRVI=mean(GRVI,na.rm=T))
Cam.VIs_stats<-Cam.VIs_stats_temp %>%
dplyr::summarise(gcc_mn=min(gcc,na.rm = T),gcc_q10=quantile(gcc,probs=0.1,na.rm=T),gcc_mm=max(gcc,na.rm = T),
rcc_mn=min(rcc,na.rm = T),rcc_q10=quantile(rcc,probs=0.1,na.rm=T),rcc_mm=max(rcc,na.rm = T),
GRVI_mn=min(GRVI,na.rm = T),GRVI_q10=quantile(GRVI,probs=0.1,na.rm=T),GRVI_mm=max(GRVI,na.rm = T),
)%>%
mutate(gcc_ampl=gcc_mm - gcc_q10,
rcc_ampl=rcc_mm - rcc_q10,
GRVI_ampl=GRVI_mm - GRVI_q10)
#adjust the original PhenoCam VIs:
df.proc_new<-left_join(df.proc,Cam.VIs_stats,by="sitename")
df.results<-df.proc_new %>%
mutate(gcc_adj= c(gcc_90 - gcc_q10)/gcc_ampl,
rcc_adj= c(rcc_90 - rcc_q10)/rcc_ampl,
GRVI_adj= c(GRVI - GRVI_q10)/GRVI_ampl)
#################
df.results$doy<-yday(df.results$date)
df.results %>%
group_by(sitename,doy)%>%
dplyr::summarise(doy=mean(doy),GCC=mean(gcc_adj,na.rm=T),
RCC=mean(rcc_adj,na.rm=T),
GRVI=mean(GRVI_adj,na.rm=T))%>%
ggplot(aes(x=doy,y=GCC))+
geom_point()+
facet_grid(~sitename)
# if(PFT=="ENF"){
#   df_summary<-df.results %>%
#     filter(sitename!="DE-Tha")
# }
df_summary<-df.results %>%
group_by(flag,doy)%>%
# filter(month<=6)%>%
dplyr::summarise(doy=mean(doy),GCC=mean(gcc_adj,na.rm=T),
RCC=mean(rcc_adj,na.rm=T),
GRVI=mean(GRVI_adj,na.rm=T),
NDVI=mean(NDVI,na.rm=T),
EVI=mean(EVI,na.rm=T),
NIRv=mean(NIRv,na.rm=T),
kNDVI=mean(kNDVI,na.rm=T)
)%>%
pivot_longer(c(GCC,RCC,GRVI,NDVI,EVI,NIRv,kNDVI),names_to = "Source",values_to = "VIs")
df_summary %>%
filter(Source %in% c("GCC","RCC","GRVI"))%>%
# ggplot(aes(x=doy,y=GCC,col=flag))+
# ggplot(aes(x=doy,y=RCC,col=flag))+
# ggplot(aes(x=doy,y=GRVI,col=flag))+
ggplot(aes(x=doy,y=VIs,col=flag))+
geom_point()+
annotate("rect",xmin=69,xmax=147,ymin = -Inf,ymax = Inf,alpha=0.2)+
scale_color_manual("",values = c("noTa_stress"="green4","Ta_stress"="tomato"),
labels=c("Less Ta stress","Higher Ta stress"))+
xlab("DoY (day)")+ylab("Normalized PhenoCam VIs")+
facet_grid(~Source)+
theme_classic()+
theme(legend.text = element_text(size=20),
axis.title = element_text(size=24),
axis.text = element_text(size = 20),
text = element_text(size=24))+
annotate(geom = "text",x=200,y=-0.1,label=PFT_name,col="blue",size=8)
df<-df.VI_new
PFT_name<-"ENF"
VI_source<-"PhenoCam"
#
df.proc<-df %>%
dplyr::select(sitename,date,EVI,NDVI,NIRv,kNDVI,
gcc_90,rcc_90,GRVI,flag,year,month,doy,PFT)%>%
filter(PFT==PFT_name)
#test
df.proc %>%
group_by(sitename,doy)%>%
dplyr::summarise(doy=mean(doy),GCC=mean(gcc_90,na.rm=T),
RCC=mean(rcc_90,na.rm=T),
GRVI=mean(GRVI,na.rm=T))%>%
ggplot(aes(x=doy,y=GCC))+
geom_point()+
facet_grid(~sitename)
#For PhenoCam VIs, in order to compare among sites, first to do the following steps:
#for each sites using the 1) smooth(mean) the data according to doy:
#2)VIs -VImin(smooth)-->(3)then normalize the VIs by ampl=VImax-VImin:
Cam.VIs_stats_temp<-df.proc %>%
group_by(sitename,doy)%>%
dplyr::summarise(doy=mean(doy),gcc=mean(gcc_90,na.rm=T),
rcc=mean(rcc_90,na.rm=T),
GRVI=mean(GRVI,na.rm=T))
Cam.VIs_stats<-Cam.VIs_stats_temp %>%
dplyr::summarise(gcc_mn=min(gcc,na.rm = T),gcc_q10=quantile(gcc,probs=0.1,na.rm=T),gcc_mm=max(gcc,na.rm = T),
rcc_mn=min(rcc,na.rm = T),rcc_q10=quantile(rcc,probs=0.1,na.rm=T),rcc_mm=max(rcc,na.rm = T),
GRVI_mn=min(GRVI,na.rm = T),GRVI_q10=quantile(GRVI,probs=0.1,na.rm=T),GRVI_mm=max(GRVI,na.rm = T),
)%>%
mutate(gcc_ampl=gcc_mm - gcc_q10,
rcc_ampl=rcc_mm - rcc_q10,
GRVI_ampl=GRVI_mm - GRVI_q10)
#adjust the original PhenoCam VIs:
df.proc_new<-left_join(df.proc,Cam.VIs_stats,by="sitename")
df.results<-df.proc_new %>%
mutate(gcc_adj= c(gcc_90 - gcc_q10)/gcc_ampl,
rcc_adj= c(rcc_90 - rcc_q10)/rcc_ampl,
GRVI_adj= c(GRVI - GRVI_q10)/GRVI_ampl)
#################
df.results$doy<-yday(df.results$date)
df.results %>%
group_by(sitename,doy)%>%
dplyr::summarise(doy=mean(doy),GCC=mean(gcc_adj,na.rm=T),
RCC=mean(rcc_adj,na.rm=T),
GRVI=mean(GRVI_adj,na.rm=T))%>%
ggplot(aes(x=doy,y=GCC))+
geom_point()+
facet_grid(~sitename)
if(PFT=="ENF"){
df_summary<-df.results %>%
filter(sitename!="DE-Tha")
}
df_summary<-df.results %>%
group_by(flag,doy)%>%
# filter(month<=6)%>%
dplyr::summarise(doy=mean(doy),GCC=mean(gcc_adj,na.rm=T),
RCC=mean(rcc_adj,na.rm=T),
GRVI=mean(GRVI_adj,na.rm=T),
NDVI=mean(NDVI,na.rm=T),
EVI=mean(EVI,na.rm=T),
NIRv=mean(NIRv,na.rm=T),
kNDVI=mean(kNDVI,na.rm=T)
)%>%
pivot_longer(c(GCC,RCC,GRVI,NDVI,EVI,NIRv,kNDVI),names_to = "Source",values_to = "VIs")
df_summary %>%
filter(Source %in% c("GCC","RCC","GRVI"))%>%
# ggplot(aes(x=doy,y=GCC,col=flag))+
# ggplot(aes(x=doy,y=RCC,col=flag))+
# ggplot(aes(x=doy,y=GRVI,col=flag))+
ggplot(aes(x=doy,y=VIs,col=flag))+
geom_point()+
annotate("rect",xmin=69,xmax=147,ymin = -Inf,ymax = Inf,alpha=0.2)+
scale_color_manual("",values = c("noTa_stress"="green4","Ta_stress"="tomato"),
labels=c("Less Ta stress","Higher Ta stress"))+
xlab("DoY (day)")+ylab("Normalized PhenoCam VIs")+
facet_grid(~Source)+
theme_classic()+
theme(legend.text = element_text(size=20),
axis.title = element_text(size=24),
axis.text = element_text(size = 20),
text = element_text(size=24))+
annotate(geom = "text",x=200,y=-0.1,label=PFT_name,col="blue",size=8)
#-----------------II.really analysis------------------------------
plot_VIs<-function(df,PFT_name,VI_source){
# df<-df.VI_new
# PFT_name<-"ENF"
# VI_source<-"PhenoCam"
#
df.proc<-df %>%
dplyr::select(sitename,date,EVI,NDVI,NIRv,kNDVI,
gcc_90,rcc_90,GRVI,flag,year,month,doy,PFT)%>%
filter(PFT==PFT_name)
#test
df.proc %>%
group_by(sitename,doy)%>%
dplyr::summarise(doy=mean(doy),GCC=mean(gcc_90,na.rm=T),
RCC=mean(rcc_90,na.rm=T),
GRVI=mean(GRVI,na.rm=T))%>%
ggplot(aes(x=doy,y=GCC))+
geom_point()+
facet_grid(~sitename)
#For PhenoCam VIs, in order to compare among sites, first to do the following steps:
#for each sites using the 1) smooth(mean) the data according to doy:
#2)VIs -VImin(smooth)-->(3)then normalize the VIs by ampl=VImax-VImin:
Cam.VIs_stats_temp<-df.proc %>%
group_by(sitename,doy)%>%
dplyr::summarise(doy=mean(doy),gcc=mean(gcc_90,na.rm=T),
rcc=mean(rcc_90,na.rm=T),
GRVI=mean(GRVI,na.rm=T))
Cam.VIs_stats<-Cam.VIs_stats_temp %>%
dplyr::summarise(gcc_mn=min(gcc,na.rm = T),gcc_q10=quantile(gcc,probs=0.1,na.rm=T),gcc_mm=max(gcc,na.rm = T),
rcc_mn=min(rcc,na.rm = T),rcc_q10=quantile(rcc,probs=0.1,na.rm=T),rcc_mm=max(rcc,na.rm = T),
GRVI_mn=min(GRVI,na.rm = T),GRVI_q10=quantile(GRVI,probs=0.1,na.rm=T),GRVI_mm=max(GRVI,na.rm = T),
)%>%
mutate(gcc_ampl=gcc_mm - gcc_q10,
rcc_ampl=rcc_mm - rcc_q10,
GRVI_ampl=GRVI_mm - GRVI_q10)
#adjust the original PhenoCam VIs:
df.proc_new<-left_join(df.proc,Cam.VIs_stats,by="sitename")
df.results<-df.proc_new %>%
mutate(gcc_adj= c(gcc_90 - gcc_q10)/gcc_ampl,
rcc_adj= c(rcc_90 - rcc_q10)/rcc_ampl,
GRVI_adj= c(GRVI - GRVI_q10)/GRVI_ampl)
#################
df.results$doy<-yday(df.results$date)
df.results %>%
group_by(sitename,doy)%>%
dplyr::summarise(doy=mean(doy),GCC=mean(gcc_adj,na.rm=T),
RCC=mean(rcc_adj,na.rm=T),
GRVI=mean(GRVI_adj,na.rm=T))%>%
ggplot(aes(x=doy,y=GCC))+
geom_point()+
facet_grid(~sitename)
# if(PFT=="ENF"){
#   df_summary<-df.results %>%
#     filter(sitename!="DE-Tha")
# }
df_summary<-df.results %>%
group_by(flag,doy)%>%
# filter(month<=6)%>%
dplyr::summarise(doy=mean(doy),GCC=mean(gcc_adj,na.rm=T),
RCC=mean(rcc_adj,na.rm=T),
GRVI=mean(GRVI_adj,na.rm=T),
NDVI=mean(NDVI,na.rm=T),
EVI=mean(EVI,na.rm=T),
NIRv=mean(NIRv,na.rm=T),
kNDVI=mean(kNDVI,na.rm=T)
)%>%
pivot_longer(c(GCC,RCC,GRVI,NDVI,EVI,NIRv,kNDVI),names_to = "Source",values_to = "VIs")
#plotting:
if(VI_source=="PhenoCam"){
p_plot<-df_summary %>%
filter(Source %in% c("GCC","RCC","GRVI"))%>%
# ggplot(aes(x=doy,y=GCC,col=flag))+
# ggplot(aes(x=doy,y=RCC,col=flag))+
# ggplot(aes(x=doy,y=GRVI,col=flag))+
ggplot(aes(x=doy,y=VIs,col=flag))+
geom_point()+
annotate("rect",xmin=69,xmax=147,ymin = -Inf,ymax = Inf,alpha=0.2)+
scale_color_manual("",values = c("noTa_stress"="green4","Ta_stress"="tomato"),
labels=c("Less Ta stress","Higher Ta stress"))+
xlab("DoY (day)")+ylab("Normalized PhenoCam VIs")+
facet_grid(~Source)+
theme_classic()+
theme(legend.text = element_text(size=20),
axis.title = element_text(size=24),
axis.text = element_text(size = 20),
text = element_text(size=24))+
annotate(geom = "text",x=200,y=-0.1,label=PFT_name,col="blue",size=8)
}
if(VI_source=="MODIS"){
p_plot<-df_summary %>%
filter(Source %in% c("NDVI","EVI","NIRv"))%>%
ggplot(aes(x=doy,y=VIs,col=flag))+
geom_point()+
annotate("rect",xmin=69,xmax=147,ymin = -Inf,ymax = Inf,alpha=0.2)+
scale_color_manual("",values = c("noTa_stress"="green4","Ta_stress"="tomato"),
labels=c("Less Ta stress","Higher Ta stress"))+
xlab("DoY (day)")+ylab("Normalized MODIS VIs")+
facet_grid(~Source)+
theme_classic()+
theme(legend.text = element_text(size=20),
axis.title = element_text(size=24),
axis.text = element_text(size = 20),
text = element_text(size=24))+
annotate(geom = "text",x=200,y=-0.1,label=PFT_name,col="blue",size=8)
}
return(p_plot)
}
#
DBF_Cam_VIs<-plot_VIs(df.VI_new,"DBF","PhenoCam")+
xlab("")
ENF_Cam_VIs<-plot_VIs(df.VI_new,"ENF","PhenoCam")
#
DBF_MODIS_VIs<-plot_VIs(df.VI_new,"DBF","MODIS")+
xlab("")
ENF_MODIS_VIs<-plot_VIs(df.VI_new,"ENF","MODIS")
#merge the plot
library(ggpubr)
library(grid)
library(cowplot)
plot_Cam_final<-plot_grid(DBF_Cam_VIs,ENF_Cam_VIs,nrow = 2,labels = "AUTO")
plot_MODIS_final<-plot_grid(DBF_MODIS_VIs,ENF_MODIS_VIs,nrow = 2,labels = "AUTO")
#save the plots:
save.path<-"./manuscript/figures/"
ggsave(paste0(save.path,"Figure3_PhenoCam_VIs.png"),plot_Cam_final,width = 15,height = 10)
ggsave(paste0(save.path,"FigureS_MODIS_VIs.png"),plot_MODIS_final,width = 15,height = 10)
